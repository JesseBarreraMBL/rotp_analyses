---
title: "ROTP Physio Preprocessing"
author: "Jesse Barrera, Rachael Yielder, Zoe Huml"
date: "6/2/23"
output: html_document
---

# Load packages

```{r}

library (readr)
library(dplyr)
library(psych)
library(lubridate)
library(mice)
library(tidyr)

```

# Import raw data

```{r}

# Set working directory

setwd("/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/ROTP + Physio Preprocessing/Raw Data")

# Import raw physio data

prescreening_raw <- read.csv("ROTP_Physio_Prescreening_Raw.csv", na.strings = c("", " "))

t1_raw <- read.csv("ROTP_Physio_T1_Raw.csv", na.strings = c("", " "))

t2_raw <- read.csv("ROTP_Physio_T2_Raw.csv", na.strings = c("", " "))

t3_raw <- read.csv("ROTP_Physio_T3_Raw.csv", na.strings = c("", " "))

t4_raw <- read.csv("ROTP_Physio_T4_Raw.csv", na.strings = c("", " "))

# Import list of participants who completed T1 blood sample

t1_sample_completed <- read.csv("ROTP_Physio_T1_completed.csv")


# Import participant ID key and change email column name to match raw datasets

setwd("/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/ID Keys")

id_key <- read.csv("ROTP_physio_id_key.csv") 


# Import biomarker dataset to help with determining dropout time

setwd("/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/Raw Data - Biomarkers")

biomarkers <- read.csv("CRP_One_Sheet.csv")

```

# Remove unecessary Qualtrics metadata

```{r}

# T1

t1_raw <- t1_raw %>% 
  select(-c(IPAddress, RecordedDate, ResponseId,
            DistributionChannel, UserLanguage, ExternalReference))

t1_raw <- t1_raw[-c(1,2), ]


# T2

t2_raw <- t2_raw %>% 
  select(-c(IPAddress, RecordedDate, ResponseId,
            DistributionChannel, UserLanguage, ExternalReference, Login.ID))

t2_raw <- t2_raw[-c(1,2), ]

# T3

t3_raw <- t3_raw %>% 
  select(-c(IPAddress, RecordedDate, ResponseId,
            DistributionChannel, UserLanguage, ExternalReference))

t3_raw <- t3_raw[-c(1,2), ]

# T4

t4_raw <- t4_raw %>% 
  select(-c(IPAddress, RecordedDate, ResponseId,
            DistributionChannel, UserLanguage, ExternalReference))

t4_raw <- t4_raw[-c(1,2), ]

```

# Remove test participants

```{r}
# Remove test participants

# Remove participants who:
## Don't have a status of "IP Address"
## Started before study was launched or after study closed
## Have an email address corresponding with a member of the lab

prescreening_raw <- prescreening_raw %>% 
  arrange(ymd_hms(StartDate)) %>% 
  filter(Status == "IP Address") %>% 
  filter((ymd_hms(StartDate) >= ymd_hms("2022-10-10 13:30:00")) & 
           (ymd_hms(StartDate) <= ymd_hms("2022-10-15 21:59:59"))) %>% 
  filter(!(RecipientEmail %in% c("zoehuml@stanford.edu", "crum@stanford.edu",  
                              "aliajcrum@gmail.com", "zoehuml1@gmail.com", 
                              "barreraj@stanford.edu", "klouis@stanford.edu", 
                              "lstraube@stanford.edu", "jzielke@stanford.edu",
                            "jbkaul@stanford.edu", "krise@stanford.edu"
                            , "kconte@stanford.edu", "megan92@stanford.edu", 
                              "kpags@stanford.edu")))

t1_raw <- t1_raw %>% 
  arrange(mdy_hm(StartDate)) %>% 
  filter(Status == "0") %>%  
  filter((mdy_hm(StartDate) >= mdy_hm("10/19/22 06:00")) & 
           (mdy_hm(StartDate) <= mdy_hm("10/24/22 23:59"))) %>% 
  filter(!(RecipientEmail %in% c("zoehuml@stanford.edu", "crum@stanford.edu",  
                              "aliajcrum@gmail.com", "zoehuml1@gmail.com", 
                              "barreraj@stanford.edu", "klouis@stanford.edu", 
                              "lstraube@stanford.edu", "jzielke@stanford.edu",
                            "jbkaul@stanford.edu", "krise@stanford.edu"
                            , "kconte@stanford.edu", "megan92@stanford.edu", 
                              "kpags@stanford.edu")))

t2_raw <- t2_raw %>% 
  filter(Status == "0") %>% 
  filter((mdy_hm(StartDate) >= mdy_hm("11/10/22 11:36")) & 
           (mdy_hm(StartDate) <= mdy_hm("11/17/22 23:59"))) %>% 
     filter(!(RecipientEmail %in% c("zoehuml@stanford.edu", "crum@stanford.edu",  
                              "aliajcrum@gmail.com", "zoehuml1@gmail.com", 
                              "barreraj@stanford.edu", "klouis@stanford.edu", 
                              "lstraube@stanford.edu", "jzielke@stanford.edu",
                            "jbkaul@stanford.edu", "krise@stanford.edu"
                            , "kconte@stanford.edu", "megan92@stanford.edu", 
                              "kpags@stanford.edu")))


t3_raw <- t3_raw %>% 
    filter(Status == "0") %>% 
  filter((mdy_hm(StartDate) >= mdy_hm("11/30/22 10:32")) & 
           (mdy_hm(StartDate) <= mdy_hm("12/05/22 23:59"))) %>% 
    filter(!(RecipientEmail %in% c("zoehuml@stanford.edu", "crum@stanford.edu",  
                              "aliajcrum@gmail.com", "zoehuml1@gmail.com", 
                              "barreraj@stanford.edu", "klouis@stanford.edu", 
                              "lstraube@stanford.edu", "jzielke@stanford.edu",
                            "jbkaul@stanford.edu", "krise@stanford.edu"
                            , "kconte@stanford.edu", "megan92@stanford.edu", 
                              "kpags@stanford.edu")))



t4_raw <- t4_raw %>% 
    filter(Status == "0") %>% 
  filter((mdy_hm(StartDate) >= mdy_hm("2/8/23 06:00")) & 
           (mdy_hm(StartDate) <= mdy_hm("2/17/23 23:59"))) %>% 
    filter(!(RecipientEmail %in% c("zoehuml@stanford.edu", "crum@stanford.edu",  
                              "aliajcrum@gmail.com", "zoehuml1@gmail.com", 
                              "barreraj@stanford.edu", "klouis@stanford.edu", 
                              "lstraube@stanford.edu", "jzielke@stanford.edu",
                            "jbkaul@stanford.edu", "krise@stanford.edu"
                            , "kconte@stanford.edu", "megan92@stanford.edu", 
                              "kpags@stanford.edu")))



```

# Remove ineligible participants

## Prescreening

### Does not meet medical eligibility criteria

```{r}

# Make list of participant emails who meet prescreening criteria

prescreening_eligible <- prescreening_raw %>%
  filter(physio_interested == "Yes" &
           physiology_opt == "Yes" &
           age == "Yes" &
           HIV == "No" &
           heart_attack_stroke == "No" &
           cancer == "No" &
           (autoimmune == "I don't have any autoimmune conditions" | 
              autoimmune == "Other (please elaborate") &
           splenectomy == "No" &
           acute._infection == "No" &
           chronic_infection == "No" &
           meds_general. == "I haven't taken any of these medication and/or treatments." &
           immunomodulators == "I haven't taken any immunomodulators" &
           monoclonals == "I haven't had any monoclonal antibody therapies" &
           IVIG. == "No"
           ) %>%
  select(RecipientEmail)


# Make list of participants who selected "Other (please elaborate)" for autoimmune
# so we can evaluate whether they are actually eligible, then potentially subtract
# the ineligible ones from prescreening_eligible

prescreening_maybes <- prescreening_raw %>%
  filter(physio_interested == "Yes" &
           physiology_opt == "Yes" &
           age == "Yes" &
           HIV == "No" &
           heart_attack_stroke == "No" &
           cancer == "No" &
           autoimmune == "Other (please elaborate)" &
           splenectomy == "No" &
           acute._infection == "No" &
           chronic_infection == "No" &
           meds_general. == "I haven't taken any of these medication and/or treatments." &
           immunomodulators == "I haven't taken any immunomodulators" &
           monoclonals == "I haven't had any monoclonal antibody therapies" &
           IVIG. == "No"
           ) %>%
  select(RecipientEmail, autoimmune_9_TEXT)

prescreening_maybes_included <- prescreening_maybes %>%
  filter(prescreening_maybes$RecipientEmail %in% t1_raw$RecipientEmail)

# Remove participants who should be screened out due to autoimmune edge cases 
# (Lexi and Daniel have reviewed)
# Create separate dataframes, one with autoimmune edge cases and one without

prescreening_autoimmune_exclude <- prescreening_maybes_included %>% 
  slice(1:3, 5)

prescreening_autoimmune_include <- prescreening_maybes_included %>% 
  slice(4, 6)

# Remove ineligible autoimmune edge cases from prescreening_eligible

prescreening_eligible <- prescreening_eligible %>% 
  filter(!(RecipientEmail %in% prescreening_autoimmune_exclude$RecipientEmail))

# filter out participants who are in later timepoints but not prescreening_eligible
# if any participants are filtered out evaluate on case by case basis

t1_raw <- t1_raw %>%
  filter(RecipientEmail %in% prescreening_eligible$RecipientEmail)

t2_raw <- t2_raw %>%
  filter(RecipientEmail %in% prescreening_eligible$RecipientEmail)

t3_raw <- t3_raw %>%
  filter(RecipientEmail %in% prescreening_eligible$RecipientEmail)

t4_raw <- t4_raw %>%
  filter(RecipientEmail %in% prescreening_eligible$RecipientEmail)

```


## T1

### Remove T1 duplicate responses

```{r}
# Remove duplicate responses, prioritizing a) the more complete response, and b) the first response

t1_raw <- t1_raw %>% 
  arrange(desc(as.numeric(Progress)), mdy_hm(StartDate)) %>% 
  distinct(RecipientEmail, .keep_all = TRUE)


```

### Did not consent to T1 survey

```{r}

t1_raw <- t1_raw %>% 
  filter(consent_pt_1 == "9" & consent_pt_2 == "1")

t2_raw <- t2_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t3_raw <- t3_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t4_raw <- t4_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)


```

### Did not complete T1 survey

```{r}

t1_raw <- t1_raw %>% 
  filter(Finished == "1")

t2_raw <- t2_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t3_raw <- t3_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t4_raw <- t4_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

```

### Took less than 1/3 of median time to complete T1 survey

```{r}

t1_raw <- t1_raw %>% 
  filter(as.numeric(Duration..in.seconds.) >= (median(as.numeric(t1_raw$Duration..in.seconds.))/3))

t2_raw <- t2_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t3_raw <- t3_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t4_raw <- t4_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

```


### Did not complete T1 blood sample

```{r}

# make list of participants who completed T1 survey and sample

t1_completed <- t1_raw %>% 
  filter(RecipientEmail %in% t1_sample_completed$email) %>% 
select(RecipientEmail) 

# filter out participants who did not complete T1 survey and sample

t1_raw <- t1_raw %>% 
  filter((RecipientEmail %in% t1_completed$RecipientEmail) & 
           (Finished == "1"))

t2_raw <- t2_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t3_raw <- t3_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

t4_raw <- t4_raw %>% 
  filter(RecipientEmail %in% t1_raw$RecipientEmail)

```

## T2

### Remove T2 duplicates

```{r}

t2_raw <- t2_raw %>% 
  arrange(desc(as.numeric(Progress)), mdy_hm(StartDate)) %>% 
  distinct(RecipientEmail, .keep_all = TRUE)

```


### Participant was not successfully randomized

```{r}

# Make a list of participants who were successfully randomized

t2_randomized <- t2_raw %>% 
  filter(!(is.na(FL_14_DO))) 

# Filter out participants who were not successfully randomized

t1_raw <- t1_raw %>% 
  filter(RecipientEmail %in% t2_randomized$RecipientEmail)

t2_raw <- t2_raw %>% 
  filter(!(is.na(FL_14_DO))) %>% 
  filter(RecipientEmail %in% t2_randomized$RecipientEmail)

t3_raw <- t3_raw %>% 
  filter(RecipientEmail %in% t2_raw$RecipientEmail)

t4_raw <- t4_raw %>% 
  filter(RecipientEmail %in% t2_raw$RecipientEmail)

```

### Calculate T2 retention statistics for CONSORT purposes

```{r}

# Make separate dataframes for each condition

t2_intervention <- t2_randomized %>% 
  filter(FL_14_DO == "Intervention")

t2_control <- t2_randomized %>% 
  filter(FL_14_DO == "Control")

# Calculate total and by-condition completion rates for T2

t2_completed <- t2_raw %>% 
  filter(Finished == "1")

t2_completed_int <- t2_completed %>% 
  filter(FL_14_DO == "Intervention")

t2_completed_con <- t2_completed %>% 
  filter(FL_14_DO == "Control")

```

## T3/T4

### Does not meet medical eligibility criteria at T3

```{r}

# filter out participants who do not meet medical eligibility criteria as measured at T3
# or T4

# Make a list of participants who do not meet eligiblity criteria at T3/T4

# Review with Lexi

# T3

t3_ineligible <- t3_raw %>%
  filter(age != "1" |
           HIV != "2" |
           heart_attack_stroke != "2" |
           cancer != "2" |
           autoimmune != "10" |
           splenectomy != "2" |
           acute._infection != "2" |
           chronic_infection != "2" |
           meds_general != "8" |
           immunomodulators != "7" |
           monoclonals != "8" |
           IVIG != "2"
           ) %>%
  select(RecipientEmail)

t3_maybes <- t3_raw %>%
  filter(age == "1" &
           HIV == "2" &
           heart_attack_stroke == "2" &
           cancer == "2" &
           autoimmune == "9" &
           splenectomy == "2" &
           acute._infection == "2" &
           chronic_infection == "2" &
           meds_general == "8" &
           immunomodulators == "7" &
           monoclonals == "8" &
           IVIG == "2"
           ) %>%
  select(RecipientEmail, autoimmune_9_TEXT)



# Write T3 maybes to Box to review with Lexi

write.csv(t3_maybes, "/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/ROTP + Physio Preprocessing/T3 Medical Questions.csv")

t4_ineligible <- t4_raw %>%
   filter(age != "1" |
           HIV != "2" |
           heart_attack_stroke != "2" |
           cancer != "2" |
           autoimmune != "10" |
           splenectomy != "2" |
           acute._infection != "2" |
           chronic_infection != "2" |
           meds_general != "8" |
           immunomodulators != "7" |
           monoclonals != "8" |
           IVIG != "2"
           ) %>%
  select(RecipientEmail)

# T4

t4_maybes <- t4_raw %>%
  filter(age == "1" &
           HIV == "2" &
           heart_attack_stroke == "2" &
           cancer == "2" &
           autoimmune == "9" &
           splenectomy == "2" &
           acute._infection == "2" &
           chronic_infection == "2" &
           meds_general == "8" &
           immunomodulators == "7" &
           monoclonals == "8" &
           IVIG == "2"
           ) %>%
  select(RecipientEmail, autoimmune_9_TEXT)

# Write T4 maybes to Box for Lexi to review

write.csv(t4_maybes, "/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/ROTP + Physio Preprocessing/Step 1 - Merge, Recode, Deidentify/T4 Medical Questions.csv")


# Filter out participants who don't meet medical eligiblity at T3/T4

t3_t4_ineligible <- bind_rows(t3_ineligible, t4_ineligible)

t1_raw <- t1_raw %>%
  filter(!(RecipientEmail %in% t3_t4_ineligible$RecipientEmail))

t2_raw <- t2_raw %>%
   filter(!(RecipientEmail %in% t3_t4_ineligible$RecipientEmail))

t3_raw <- t3_raw %>%
   filter(!(RecipientEmail %in% t3_t4_ineligible$RecipientEmail))

t4_raw <- t4_raw %>%
   filter(!(RecipientEmail %in% t3_t4_ineligible$RecipientEmail))

```

### Remove T3 duplicates

```{r}

t3_raw <- t3_raw %>% 
  arrange(desc(as.numeric(Progress)), mdy_hm(StartDate)) %>% 
  distinct(RecipientEmail, .keep_all = TRUE)

```


### Calculate T3 retention statistics for CONSORT purposes

```{r}
 
# Calculate total and by-condition completion rates for T3

t3_completed <- t3_raw %>% 
  filter(Finished == "1")

t3_completed_int <- t3_completed %>% 
  filter(RecipientEmail %in% t2_intervention$RecipientEmail)

t3_completed_con <- t3_completed %>% 
  filter(RecipientEmail %in% t2_control$RecipientEmail)
```

### Remove T4 duplicates

```{r}

t4_raw <- t4_raw %>% 
  arrange(desc(as.numeric(Progress)), mdy_hm(StartDate)) %>% 
  distinct()

```


### Calculate T4 retention statistics for CONSORT purposes

```{r}
 
# Calculate total and by-condition completion rates for T3

t4_completed <- t4_raw %>% 
  filter(Finished == "1")

t4_completed_int <- t4_completed %>% 
  filter(RecipientEmail %in% t2_intervention$RecipientEmail)

t4_completed_con <- t4_completed %>% 
  filter(RecipientEmail %in% t2_control$RecipientEmail)

```

# Merge data

## Change name of condition variable

```{r}

t2_raw <- t2_raw %>% 
  rename("Condition" = "FL_14_DO")

#Test

```


## Edit variable names to prepare for merging timepoints

```{r}

# T1

colnames(t1_raw) <- gsub("_t1", "", colnames(t1_raw))

colnames(t1_raw) <- paste(colnames(t1_raw), "t1", sep = "_")

t1_raw <- t1_raw %>% 
  rename("RecipientEmail" = "RecipientEmail_t1")

# T2

colnames(t2_raw) <- gsub("_t1", "", colnames(t2_raw))

colnames(t2_raw) <- gsub("_t2", "", colnames(t2_raw))

colnames(t2_raw) <- paste(colnames(t2_raw), "t2", sep = "_") 

t2_raw <- t2_raw %>% 
  rename("RecipientEmail" = "RecipientEmail_t2")


# T3

colnames(t3_raw) <- gsub("_t3", "", colnames(t3_raw))

colnames(t3_raw) <- paste(colnames(t3_raw), "t3", sep = "_") 

t3_raw <- t3_raw %>% 
  rename("RecipientEmail" = "RecipientEmail_t3")

# T4

colnames(t4_raw) <- gsub("_t4", "", colnames(t4_raw))

colnames(t4_raw) <- paste(colnames(t4_raw), "t4", sep = "_") 

t4_raw <- t4_raw %>% 
  rename("RecipientEmail" = "RecipientEmail_t4")


```

## Merge data in wide format 

```{r}

# Merge T1 and T2 dataframes using left_join (retaining all rows from T1 and matching 
# rows from T2)

t1_t2_physio <- left_join(t1_raw, t2_raw, by = "RecipientEmail")

# Merge T3 and T4 dataframes using full_join (retaining all rows from T3 and T4)

t3_t4_physio <- full_join(t3_raw, t4_raw, by = "RecipientEmail")

# Merge all four timpeoints into a single dataframe using left_join 

physio_merged_raw <- left_join(t1_t2_physio, t3_t4_physio, by = "RecipientEmail")

```

# Recode variables

## Convert numeric variables to integers

```{r}

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c("Duration..in.seconds._t1",
                  "Finished_t1",
                  "prh_routine_t1",
                  'prh_income_t1',
                "prh_food_t1",
                "prh_housing_t1",
                "prh_medical_t1",
                "prh_mental_t1", 
                "prh_support_t1",
                "prh_stress_t1",
                "prh_discord_t1",
                "prh_care_t1",
                "prh_self_cov_t1",
                "prh_fam_cov_sym_t1",
                "prh_ext_cov_sym_t1",
                "co_mindset_1_t1":"vax_status_t1",
                "age_t1", "gender_t1", "race_ethnicity_t1",
                "education_t1":"political_party_t1",
                "household_18_t1":"caregiving_13_t1",
                "global_health_base_1_t2":"prh_self_cov_t2",
                "cov_months_1_t2":"long_covid_t2",
                "cov_number_t2", 
                "Step.3.Permission_t2",
                "Duration..in.seconds._t3",
                "Finished_t3",
                "age_t3":"autoimmune_t3",
                "splenectomy_t3":"IVIG_t3",
                "COVID.Status_t3":"autoimmune_t4",
                "splenectomy_t4":"prh_routine_t1_t4",
                "prh_income_t1_t4",
                "prh_food_t1_t4",
                "prh_housing_t1_t4",
                "prh_medical_t1_t4",
                "prh_mental_t1_t4", 
                "prh_support_t1_t4",
                "prh_stress_t1_t4",
                "prh_discord_t1_t4",
                "prh_care_t1_t4",
                "COVID.Status_t4":"seh_1_1_y_t4",
                "seh_2_1_x_t4", "seh_2_1_y_t4",
                "she_3_1_x_t4", "she_3_1_y_t4",
                "optimism_1_t4":"primals_6_t4"), as.numeric))


```

# Convert variables to factors or chars as appropriate

```{r}

# Consent

physio_merged_raw$consent_pt_1_t1 <- gsub("9", "Agree", physio_merged_raw$consent_pt_1_t1)

physio_merged_raw$consent_pt_2_t1 <- gsub("1", "Agree", physio_merged_raw$consent_pt_2_t1)

str(physio_merged_raw)



# Vaccination Status

physio_merged_raw$vax_status_t1 <- cut(physio_merged_raw$vax_status_t1, 4, labels = c("Fully vaccinated, including booster shot", "Fully vaccinated, not including booster shot", "Partially vaccinated", "Unvaccinated"))

physio_merged_raw$COVID.Vaccine.Statu_t4 <- cut(physio_merged_raw$COVID.Vaccine.Statu_t4, 3, labels = c("Yes - I got vaccinated for the first time", "Yes - I got an additional COVID-19 vaccine/booster", "No"))

# Employment

physio_merged_raw$employment_t1 <- gsub("5", "I was fired from a job", gsub("11", "I was laid off from a job", 
                                        gsub("12", "I voluntarily quit my job", gsub("13", "I started a new job", gsub("14", "I became voluntarily unemployed", gsub("15", "I became involuntarily unemployed", gsub( "16", "Other (please specify)", gsub("17", "None of the above" ,physio_merged_raw$employment_t1))))))))

# Religion

physio_merged_raw$religion_t1 <- gsub("4", "Jewish", gsub("12", "Christina", gsub("13", "Muslim", 
                                          gsub("14", "Hindu", gsub("15", "Buddhist", gsub("16", "Sikh",
                                          gsub("17", "Baha'i", gsub("18", "Atheist", gsub("19", "Agnostic",
                                          gsub("20", "Other (please specify)", gsub("21", "Nothing in particular",
                                          gsub("22", "Don't know", gsub("23", "Prefer not to say", physio_merged_raw$religion_t1)))))))))))))

# Gender

physio_merged_raw$gender_t1 <- gsub("1", "Woman", gsub("2", "Man", gsub("3", "Non-Binary", gsub("4", "Prefer other term", physio_merged_raw$gender_t1))))

# Race/Ethnicity

physio_merged_raw$race_ethnicity_t1 <- gsub("1", "Asian", gsub("2", "Hispanic", gsub("3", "Black", gsub("4", "White",
                                      gsub("5", "Middle Eastern", gsub("6", "Native American", gsub("7", "Multiracial", gsub("8", "Other", physio_merged_raw$race_ethnicity_t1))))))))

# Political Affilation

physio_merged_raw$political_party_t1 <- gsub("1", "Republican", gsub("2", "Democrat", gsub("3", "Independent", gsub("4", "Other", physio_merged_raw$political_party_t1))))


```


## Convert StartDate and EndDate from char to mdy_hm

```{r}

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c("StartDate_t1", "EndDate_t1", "StartDate_t2", "EndDate_t2",
                "StartDate_t3", "EndDate_t3", "StartDate_t4", "EndDate_t4"), 
         mdy_hm))
```

# Change column names to prepare for merging with non-physio and longitudinal

## Change timepoint identifiers

```{r}

colnames(physio_merged_raw) <- gsub("_t1", "_t5", colnames(physio_merged_raw))

colnames(physio_merged_raw) <- gsub("_t2", "_t6", colnames(physio_merged_raw))

colnames(physio_merged_raw) <- gsub("_t3", "_t7", colnames(physio_merged_raw))

colnames(physio_merged_raw) <- gsub("_t4", "_t8", colnames(physio_merged_raw))


```

## Add physio branch identifier

```{r}

colnames(physio_merged_raw) <- paste(colnames(physio_merged_raw), "physio", sep = "_")

```

## Additional column name changes as needed

```{r}

physio_merged_raw <- physio_merged_raw %>% 
  rename("RecipientEmail" = "RecipientEmail_physio",
         "consent_specimens_t5_physio" = "consent_pt_1_t5_physio",
         "consent_t5_physio" = "consent_pt_2_t5_physio",
    "duration_t5_physio" = "Duration..in.seconds._t5_physio",
         "duration_t6_physio" = "Duration..in.seconds._t6_physio",
         "duration_t7_physio" = "Duration..in.seconds._t7_physio",
         "duration_t8_physio" = "Duration..in.seconds._t8_physio",
         "phq_1_t5_physio" = "phq._1_t5_physio",
         "phq_2_t5_physio" = "phq._2_t5_physio",
         "phq_3_t5_physio" = "phq._3_t5_physio",
         "phq_4_t5_physio" = "phq._4_t5_physio",
         "prh_self_cov_t6_physio" = "prh_self_cov_t6_physio",
         "prh_self_cov_free_t6_physio" = "prh_self_cov_free_t6_physio",
          "employment_change_t5_physio" = "employment_t5_physio",
         "condition_physio" = "Condition_t6_physio",
         "autoimmune_free_t7_physio" = "autoimmune_9_TEXT_t7_physio",
         "autoimmune_free_t8_physio" = "autoimmune_9_TEXT_t8_physio",
         "cov_sym_t7_physio" = "COVID.Symptoms_t7_physio",
         "cov_sym_free_t7_physio" = "COVID.Symptoms_29_TEXT_t7_physio",
         "cov_status_t7_physio" = "COVID.Status_t7_physio",
         "prh_routine_t8_physio" = "prh_routine_t5_t8_physio",
         "prh_routine_free_t8_physio" = "prh_routine_free_t5_t8_physio",
          "prh_income_t8_physio" = "prh_income_t5_t8_physio",
         "prh_income_free_t8_physio" = "prh_income_free_t5_t8_physio",
           "prh_food_t8_physio" = "prh_food_t5_t8_physio",
         "prh_food_free_t8_physio" = "prh_food_free_t5_t8_physio",
           "prh_housing_t8_physio" = "prh_housing_t5_t8_physio",
         "prh_housing_free_t8_physio" = "prh_housing_free_t5_t8_physio",
           "prh_medical_t8_physio" = "prh_medical_t5_t8_physio",
         "prh_medical_free_t8_physio" = "prh_medical_free_t5_t8_physio",
           "prh_mental_t8_physio" = "prh_mental_t5_t8_physio",
         "prh_mental_free_t8_physio" = "prh_mental_free_t5_t8_physio",
           "prh_support_t8_physio" = "prh_support_t5_t8_physio",
         "prh_support_free_t8_physio" = "prh_support_free_t5_t8_physio",
           "prh_stress_t8_physio" = "prh_stress_t5_t8_physio",
         "prh_stress_free_t8_physio" = "prh_stress_free_t5_t8_physio",
           "prh_discord_t8_physio" = "prh_discord_t5_t8_physio",
         "prh_discord_free_t8_physio" = "prh_discord_free_t5_t8_physio",
           "prh_care_t8_physio" = "prh_care_t5_t8_physio",
         "prh_care_free_t8_physio" = "prh_care_free_t5_t8_physio",
          "cov_sym_t8_physio" = "COVID.Symptoms_t8_physio",
         "cov_sym_free_t8_physio" = "COVID.Symptoms_29_TEXT_t8_physio",
         "cov_status_t8_physio" = "COVID.Status_t8_physio",
         "cov_vax_stat_t8_physio" = "COVID.Vaccine.Statu_t8_physio",
         "seh_3_1_x_t8_physio" = "she_3_1_x_t8_physio",
         "seh_3_1_y_t8_physio" = "she_3_1_y_t8_physio",
         "seh_3_t8_physio" = "she_3_t8_physio"
          )

```

# Participant retention

## Calculate dropout time

```{r}

# Replace NA with '0' for all Finished_tX_physio variables:

## T5 - Not needed (all participants completed T5 survey)

## T6

physio_merged_raw$Finished_t6_physio[is.na(physio_merged_raw$Finished_t6_physio)] <- 0

## T7

physio_merged_raw$Finished_t7_physio[is.na(physio_merged_raw$Finished_t7_physio)] <- 0

## T8

physio_merged_raw$Finished_t8_physio[is.na(physio_merged_raw$Finished_t8_physio)] <- 0


# Change all Finished_tX_physio to factor variables:

## T5

physio_merged_raw$Finished_t5_physio <- as.character(physio_merged_raw$Finished_t5_physio)

## T6

physio_merged_raw$Finished_t6_physio <- as.character(physio_merged_raw$Finished_t6_physio)

## T7

physio_merged_raw$Finished_t7_physio <- as.character(physio_merged_raw$Finished_t7_physio)

## T8

physio_merged_raw$Finished_t8_physio <- as.character(physio_merged_raw$Finished_t8_physio)

# Create a retention variable of progression through study surveys. Showing when participants were lost to follow-up, and when participants did not complete (DNC) a timepoint but did return to the study for a later timepoint.
## Note: T5 not included as all participants completed T5 survey.


physio_merged_raw <- physio_merged_raw %>%
mutate(participant_retention_physio = case_when(Finished_t8_physio == '1' & Finished_t7_physio == '1' &    Finished_t6_physio == '1'  ~ "All", #Completed ALL timepoints
                                                    Finished_t8_physio == '0' & Finished_t7_physio == '1' & Finished_t6_physio == '0' ~ "N/T6, Y/T7, N/T8", #DNC T6, returned for T7, lost at T8
                                                    Finished_t8_physio == '1' & Finished_t7_physio == '0' & Finished_t6_physio == '1' ~ "Y/T6, N/T7, Y/T8", #DNC T7, returned for T8
                                                    Finished_t8_physio == '1' & Finished_t7_physio == '0' & Finished_t6_physio == '0' ~ "N/T6/T7, Y/T8", #DNC T6 or T7, returned for T8
                                                    Finished_t8_physio == '1' & Finished_t7_physio == '1' & Finished_t6_physio == '0' ~ "N/T6, Y/T7/T8", #DNC T6, returned for T7 & T8
                                                    Finished_t8_physio == '0' & Finished_t7_physio == '1' & Finished_t6_physio == '1' ~ "T8", #Lost at T8
                                                    Finished_t8_physio == '0' & Finished_t7_physio == '0' & Finished_t6_physio == '1' ~ "T7", #Lost at T7
                                                    Finished_t8_physio == '0' & Finished_t7_physio == '0' & Finished_t6_physio == '0' ~ "T6" )) #Lost at T6


```

## Calculate intervention/control completion

```{r}

# Add intervention/control column to physio_merged_raw

physio_merged_raw <- physio_merged_raw %>% 
  mutate(int_con_completion_physio = case_when(Finished_t6_physio == "1" ~ "Complete",
                                                   Finished_t6_physio != "1" ~ "Incomplete"))

```


# Summary Scores

## PTGI full

### Reverse score and rescale items

```{r}

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(ptg_1_t5_physio:ptg_21_t5_physio), ~.-1))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(ptg_1_t7_physio:ptg_21_t7_physio), ~.-1))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(ptg_1_t8_physio:ptg_21_t8_physio), ~.-1))

```

### Calculate summary scores and alphas

```{r}

# Calculate summary scores

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_full_t5_physio = rowSums(select(., ptg_1_t5_physio:ptg_21_t5_physio)))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_full_t7_physio = rowSums(select(., ptg_1_t7_physio:ptg_21_t7_physio)))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_full_t8_physio = rowSums(select(., ptg_1_t8_physio:ptg_21_t8_physio)))

# Make summary score dataframes

ptgi_full_t5_physio_df <- physio_merged_raw %>% 
  select(ptg_1_t5_physio:ptg_21_t5_physio)

psych::alpha(ptgi_full_t5_physio_df)

ptgi_full_t7_physio_df <- physio_merged_raw %>% 
  select(ptg_1_t7_physio:ptg_21_t7_physio)

psych::alpha(ptgi_full_t7_physio_df)


ptgi_full_t8_physio_df <- physio_merged_raw %>% 
  select(ptg_1_t8_physio:ptg_21_t8_physio)

psych::alpha(ptgi_full_t8_physio_df)


```

## PTGI abridged

### Calculate summary scores and alphas

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_abridged_t5_physio = (ptg_1_t5_physio + ptg_2_t5_physio + ptg_3_t5_physio + ptg_4_t5_physio + ptg_6_t5_physio + ptg_7_t5_physio + ptg_8_t5_physio + ptg_9_t5_physio + ptg_10_t5_physio + ptg_11_t5_physio + ptg_12_t5_physio + ptg_13_t5_physio + ptg_14_t5_physio + ptg_15_t5_physio + ptg_16_t5_physio + ptg_17_t5_physio + ptg_18_t5_physio + ptg_20_t5_physio + ptg_21_t5_physio))


ptgi_abridged_t5_physio_df <- physio_merged_raw %>% 
  select(ptg_1_t5_physio, ptg_2_t5_physio, ptg_3_t5_physio, ptg_4_t5_physio, ptg_6_t5_physio, ptg_7_t5_physio, ptg_8_t5_physio, ptg_9_t5_physio, ptg_10_t5_physio, ptg_11_t5_physio, ptg_12_t5_physio, ptg_13_t5_physio, ptg_14_t5_physio, ptg_15_t5_physio, ptg_16_t5_physio, ptg_17_t5_physio, ptg_18_t5_physio, ptg_20_t5_physio, ptg_21_t5_physio)

psych::alpha(ptgi_abridged_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_abridged_t7_physio = (ptg_1_t7_physio + ptg_2_t7_physio + ptg_3_t7_physio + ptg_4_t7_physio + ptg_6_t7_physio + ptg_7_t7_physio + ptg_8_t7_physio + ptg_9_t7_physio + ptg_10_t7_physio + ptg_11_t7_physio + ptg_12_t7_physio + ptg_13_t7_physio + ptg_14_t7_physio + ptg_15_t7_physio + ptg_16_t7_physio + ptg_17_t7_physio + ptg_18_t7_physio + ptg_20_t7_physio + ptg_21_t7_physio))


ptgi_abridged_t7_physio_df <- physio_merged_raw %>% 
  select(ptg_1_t7_physio, ptg_2_t7_physio, ptg_3_t7_physio, ptg_4_t7_physio, ptg_6_t7_physio, ptg_7_t7_physio, ptg_8_t7_physio, ptg_9_t7_physio, ptg_10_t7_physio, ptg_11_t7_physio, ptg_12_t7_physio, ptg_13_t7_physio, ptg_14_t7_physio, ptg_15_t7_physio, ptg_16_t7_physio, ptg_17_t7_physio, ptg_18_t7_physio, ptg_20_t7_physio, ptg_21_t7_physio)

psych::alpha(ptgi_abridged_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_abridged_t8_physio = (ptg_1_t8_physio + ptg_2_t8_physio + ptg_3_t8_physio + ptg_4_t8_physio + ptg_6_t8_physio + ptg_7_t8_physio + ptg_8_t8_physio + ptg_9_t8_physio + ptg_10_t8_physio + ptg_11_t8_physio + ptg_12_t8_physio + ptg_13_t8_physio + ptg_14_t8_physio + ptg_15_t8_physio + ptg_16_t8_physio + ptg_17_t8_physio + ptg_18_t8_physio + ptg_20_t8_physio + ptg_21_t8_physio))


ptgi_abridged_t8_physio_df <- physio_merged_raw %>% 
  select(ptg_1_t8_physio, ptg_2_t8_physio, ptg_3_t8_physio, ptg_4_t8_physio, ptg_6_t8_physio, ptg_7_t8_physio, ptg_8_t8_physio, ptg_9_t8_physio, ptg_10_t8_physio, ptg_11_t8_physio, ptg_12_t8_physio, ptg_13_t8_physio, ptg_14_t8_physio, ptg_15_t8_physio, ptg_16_t8_physio, ptg_17_t8_physio, ptg_18_t8_physio, ptg_20_t8_physio, ptg_21_t8_physio)

psych::alpha(ptgi_abridged_t8_physio_df)

```

## PTGI subscales

### Calculate summary scores

```{r}

# T5

## Relationships 

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_relationships_t5_physio = (ptg_6_t5_physio + ptg_7_t5_physio + 
                                    ptg_9_t5_physio + ptg_12_t5_physio + ptg_15_t5_physio + ptg_17_t5_physio + ptg_20_t5_physio))

ptgi_relationships_t5_df_physio <- physio_merged_raw %>% 
  select(ptg_6_t5_physio, ptg_7_t5_physio, 
                                    ptg_9_t5_physio, ptg_12_t5_physio, ptg_15_t5_physio, ptg_17_t5_physio, ptg_20_t5_physio)

psych::alpha(ptgi_relationships_t5_df_physio)

## Possibilities

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_possibilities_t5_physio = (ptg_2_t5_physio + ptg_13_t5_physio + 
        ptg_14_t5_physio + ptg_18_t5_physio + ptg_21_t5_physio))

ptgi_possibilities_t5_df_physio <- physio_merged_raw %>% 
  select(ptg_2_t5_physio, ptg_13_t5_physio, 
        ptg_14_t5_physio, ptg_18_t5_physio, ptg_21_t5_physio)

psych::alpha(ptgi_possibilities_t5_df_physio)

## Strength

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_strength_t5_physio = (ptg_4_t5_physio + ptg_8_t5_physio + 
        ptg_10_t5_physio + ptg_16_t5_physio))

ptgi_strength_t5_df_physio <- physio_merged_raw %>% 
  select(ptg_4_t5_physio, ptg_8_t5_physio,  
        ptg_10_t5_physio, ptg_16_t5_physio)

psych::alpha(ptgi_strength_t5_df_physio)

## Appreciation

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_appreciation_t5_physio = (ptg_1_t5_physio + ptg_3_t5_physio + 
        ptg_11_t5_physio))

ptgi_appreciation_t5_df_physio <- physio_merged_raw %>% 
  select(ptg_1_t5_physio, ptg_3_t5_physio,  
        ptg_11_t5_physio)

psych::alpha(ptgi_appreciation_t5_df_physio)

## Spiritual

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_spiritual_t5_physio = (ptg_5_t5_physio + ptg_19_t5_physio))

ptgi_spiritual_t5_df_physio <- physio_merged_raw %>% 
  select(ptg_5_t5_physio, ptg_19_t5_physio)

psych::alpha(ptgi_spiritual_t5_df_physio)


# T7

## Relationships 

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_relationships_t7_physio = (ptg_6_t7_physio + ptg_7_t7_physio + 
                                    ptg_9_t7_physio + ptg_12_t7_physio + ptg_15_t7_physio + ptg_17_t7_physio + ptg_20_t7_physio))

ptgi_relationships_t7_df_physio <- physio_merged_raw %>% 
  select(ptg_6_t7_physio, ptg_7_t7_physio, 
                                    ptg_9_t7_physio, ptg_12_t7_physio, ptg_15_t7_physio, ptg_17_t7_physio, ptg_20_t7_physio)

psych::alpha(ptgi_relationships_t7_df_physio)

## Possibilities

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_possibilities_t7_physio = (ptg_2_t7_physio + ptg_13_t7_physio + 
        ptg_14_t7_physio + ptg_18_t7_physio + ptg_21_t7_physio))

ptgi_possibilities_t7_df_physio <- physio_merged_raw %>% 
  select(ptg_2_t7_physio, ptg_13_t7_physio, 
        ptg_14_t7_physio, ptg_18_t7_physio, ptg_21_t7_physio)

psych::alpha(ptgi_possibilities_t7_df_physio)

## Strength

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_strength_t7_physio = (ptg_4_t7_physio + ptg_8_t7_physio + 
        ptg_10_t7_physio + ptg_16_t7_physio))

ptgi_strength_t7_df_physio <- physio_merged_raw %>% 
  select(ptg_4_t7_physio, ptg_8_t7_physio,  
        ptg_10_t7_physio, ptg_16_t7_physio)

psych::alpha(ptgi_strength_t7_df_physio)

## Appreciation

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_appreciation_t7_physio = (ptg_1_t7_physio + ptg_3_t7_physio + 
        ptg_11_t7_physio))

ptgi_appreciation_t7_df_physio <- physio_merged_raw %>% 
  select(ptg_1_t7_physio, ptg_3_t7_physio,  
        ptg_11_t7_physio)

psych::alpha(ptgi_appreciation_t7_df_physio)

## Spiritual

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_spiritual_t7_physio = (ptg_5_t7_physio + ptg_19_t7_physio))

ptgi_spiritual_t7_df_physio <- physio_merged_raw %>% 
  select(ptg_5_t7_physio, ptg_19_t7_physio)

psych::alpha(ptgi_spiritual_t7_df_physio)

# T8

## Relationships 

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_relationships_t8_physio = (ptg_6_t8_physio + ptg_7_t8_physio + 
                                    ptg_9_t8_physio + ptg_12_t8_physio + ptg_15_t8_physio + ptg_17_t8_physio + ptg_20_t8_physio))

ptgi_relationships_t8_df_physio <- physio_merged_raw %>% 
  select(ptg_6_t8_physio, ptg_7_t8_physio, 
                                    ptg_9_t8_physio, ptg_12_t8_physio, ptg_15_t8_physio, ptg_17_t8_physio, ptg_20_t8_physio)

psych::alpha(ptgi_relationships_t8_df_physio)

## Possibilities

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_possibilities_t8_physio = (ptg_2_t8_physio + ptg_13_t8_physio + 
        ptg_14_t8_physio + ptg_18_t8_physio + ptg_21_t8_physio))

ptgi_possibilities_t8_df_physio <- physio_merged_raw %>% 
  select(ptg_2_t8_physio, ptg_13_t8_physio, 
        ptg_14_t8_physio, ptg_18_t8_physio, ptg_21_t8_physio)

psych::alpha(ptgi_possibilities_t8_df_physio)

## Strength

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_strength_t8_physio = (ptg_4_t8_physio + ptg_8_t8_physio + 
        ptg_10_t8_physio + ptg_16_t8_physio))

ptgi_strength_t8_df_physio <- physio_merged_raw %>% 
  select(ptg_4_t8_physio, ptg_8_t8_physio,  
        ptg_10_t8_physio, ptg_16_t8_physio)

psych::alpha(ptgi_strength_t8_df_physio)

## Appreciation

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_appreciation_t8_physio = (ptg_1_t8_physio + ptg_3_t8_physio + 
        ptg_11_t8_physio))

ptgi_appreciation_t8_df_physio <- physio_merged_raw %>% 
  select(ptg_1_t8_physio, ptg_3_t8_physio,  
        ptg_11_t8_physio)

psych::alpha(ptgi_appreciation_t8_df_physio)

## Spiritual

physio_merged_raw <- physio_merged_raw %>% 
  mutate(ptgi_spiritual_t8_physio = (ptg_5_t8_physio + ptg_19_t8_physio))

ptgi_spiritual_t8_df_physio <- physio_merged_raw %>% 
  select(ptg_5_t8_physio, ptg_19_t8_physio)

psych::alpha(ptgi_spiritual_t8_df_physio)



```


# CO Mindset

## Reverse score items 

```{r}

#T5 Reverse Scoring 

co_reverse_columns_t5 <- physio_merged_raw %>% 
  select(co_mindset_1_t5_physio, co_mindset_3_t5_physio, co_mindset_4_t5_physio,
         co_mindset_7_t5_physio, co_mindset_9_t5_physio) %>% 
  colnames()


physio_merged_raw[ ,co_reverse_columns_t5] <- 8 - physio_merged_raw[ ,co_reverse_columns_t5]



#T7 Reverse Scoring 

co_reverse_columns_t7 <- physio_merged_raw %>% 
  select(co_mindset_1_t7_physio, co_mindset_3_t7_physio, co_mindset_4_t7_physio,
         co_mindset_7_t7_physio, co_mindset_9_t7_physio) %>% 
  colnames()


physio_merged_raw[ ,co_reverse_columns_t7] <- 8 - physio_merged_raw[ ,co_reverse_columns_t7]

#T8 Reverse Scoring 

co_reverse_columns_t8 <- physio_merged_raw %>% 
  select(co_mindset_1_t8_physio, co_mindset_3_t8_physio, co_mindset_4_t8_physio,
         co_mindset_7_t8_physio, co_mindset_9_t8_physio) %>% 
  colnames()


physio_merged_raw[ ,co_reverse_columns_t8] <- 8 - physio_merged_raw[ ,co_reverse_columns_t8]


```

## Calculate summary scores and alphas CO Mindset 

```{r calculate summary scores for co mindset}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(co_mindset_t5_physio = rowMeans(select(., co_mindset_1_t5_physio:co_mindset_10_t5_physio)))

co_mindset_t5_physio_df <- physio_merged_raw %>% 
  select(co_mindset_1_t5_physio:co_mindset_10_t5_physio)

psych::alpha(co_mindset_t5_physio_df)


# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(co_mindset_t7_physio = rowMeans(select(., co_mindset_1_t7_physio:co_mindset_10_t7_physio)))

co_mindset_t7_physio_df <- physio_merged_raw %>% 
  select(co_mindset_1_t7_physio:co_mindset_10_t7_physio)

psych::alpha(co_mindset_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(co_mindset_t8_physio = rowMeans(select(., co_mindset_1_t8_physio:co_mindset_10_t8_physio)))

co_mindset_t8_physio_df <- physio_merged_raw %>% 
  select(co_mindset_1_t8_physio:co_mindset_10_t8_physio)

psych::alpha(co_mindset_t8_physio_df)

```

## Positive Affect

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(pos_affect_t5_physio = rowSums(select(., panas_1_t5_physio, panas_3_t5_physio , panas_5_t5_physio, panas_9_t5_physio, panas_10_t5_physio, panas_12_t5_physio,  panas_14_t5_physio, panas_16_t5_physio, panas_17_t5_physio, panas_19_t5_physio)))

pos_affect_t5_physio_df <- physio_merged_raw %>% 
  select(panas_1_t5_physio, panas_3_t5_physio , panas_5_t5_physio, panas_9_t5_physio, panas_10_t5_physio, panas_12_t5_physio,  panas_14_t5_physio, panas_16_t5_physio, panas_17_t5_physio, panas_19_t5_physio)

psych::alpha(pos_affect_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(pos_affect_t7_physio = rowSums(select(., panas_1_t7_physio, panas_3_t7_physio , panas_5_t7_physio, panas_9_t7_physio, panas_10_t7_physio, panas_12_t7_physio,  panas_14_t7_physio, panas_16_t7_physio, panas_17_t7_physio, panas_19_t7_physio)))

pos_affect_t7_physio_df <- physio_merged_raw %>% 
  select(panas_1_t7_physio, panas_3_t7_physio , panas_5_t7_physio, panas_9_t7_physio, panas_10_t7_physio, panas_12_t7_physio,  panas_14_t7_physio, panas_16_t7_physio, panas_17_t7_physio, panas_19_t7_physio)

psych::alpha(pos_affect_t7_physio_df)


# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(pos_affect_t8_physio = rowSums(select(., panas_1_t8_physio, panas_3_t8_physio , panas_5_t8_physio, panas_9_t8_physio, panas_10_t8_physio, panas_12_t8_physio,  panas_14_t8_physio, panas_16_t8_physio, panas_17_t8_physio, panas_19_t8_physio)))

pos_affect_t8_physio_df <- physio_merged_raw %>% 
  select(panas_1_t8_physio, panas_3_t8_physio , panas_5_t8_physio, panas_9_t8_physio, panas_10_t8_physio, panas_12_t8_physio,  panas_14_t8_physio, panas_16_t8_physio, panas_17_t8_physio, panas_19_t8_physio)

psych::alpha(pos_affect_t8_physio_df)


```


## Negative Affect

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(neg_affect_t5_physio = rowSums(select(., panas_2_t5_physio, panas_4_t5_physio , panas_6_t5_physio, panas_7_t5_physio, panas_8_t5_physio, panas_11_t5_physio,  panas_13_t5_physio, panas_15_t5_physio, panas_18_t5_physio, panas_20_t5_physio)))

neg_affect_t5_physio_df <- physio_merged_raw %>% 
  select(panas_2_t5_physio, panas_4_t5_physio , panas_6_t5_physio, panas_7_t5_physio, panas_8_t5_physio, panas_11_t5_physio,  panas_13_t5_physio, panas_15_t5_physio, panas_18_t5_physio, panas_20_t5_physio)

psych::alpha(neg_affect_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(neg_affect_t7_physio = rowSums(select(., panas_2_t7_physio, panas_4_t7_physio , panas_6_t7_physio, panas_7_t7_physio, panas_8_t7_physio, panas_11_t7_physio,  panas_13_t7_physio, panas_15_t7_physio, panas_18_t7_physio, panas_20_t7_physio)))

neg_affect_t7_physio_df <- physio_merged_raw %>% 
  select(panas_2_t7_physio, panas_4_t7_physio , panas_6_t7_physio, panas_7_t7_physio, panas_8_t7_physio, panas_11_t7_physio,  panas_13_t7_physio, panas_15_t7_physio, panas_18_t7_physio, panas_20_t7_physio)

psych::alpha(neg_affect_t7_physio_df)


# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(neg_affect_t8_physio = rowSums(select(., panas_2_t8_physio, panas_4_t8_physio , panas_6_t8_physio, panas_7_t8_physio, panas_8_t8_physio, panas_11_t8_physio,  panas_13_t8_physio, panas_15_t8_physio, panas_18_t8_physio, panas_20_t8_physio)))

neg_affect_t8_physio_df <- physio_merged_raw %>% 
  select(panas_2_t8_physio, panas_4_t8_physio , panas_6_t8_physio, panas_7_t8_physio, panas_8_t8_physio, panas_11_t8_physio,  panas_13_t8_physio, panas_15_t8_physio, panas_18_t8_physio, panas_20_t8_physio)

psych::alpha(neg_affect_t8_physio_df)


```

## PHQ-4

### Rescale items

```{r}

# Rescale from a 1-4 to a 0-3 scale

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(phq_1_t5_physio:phq_4_t5_physio), ~.-1))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(phq_1_t7_physio:phq_4_t7_physio), ~.-1))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(phq_1_t8_physio:phq_4_t8_physio), ~.-1))


```

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_full_t5_physio = rowSums(select(., phq_1_t5_physio:phq_4_t5_physio)))

phq_full_t5_physio_df <- physio_merged_raw %>% 
  select(phq_1_t5_physio:phq_4_t5_physio)

psych::alpha(phq_full_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_full_t7_physio = rowSums(select(., phq_1_t7_physio:phq_4_t7_physio)))

phq_full_t7_physio_df <- physio_merged_raw %>% 
  select(phq_1_t7_physio:phq_4_t7_physio)

psych::alpha(phq_full_t7_physio_df)


# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_full_t8_physio = rowSums(select(., phq_1_t8_physio:phq_4_t8_physio)))

phq_full_t8_physio_df <- physio_merged_raw %>% 
  select(phq_1_t8_physio:phq_4_t8_physio)

psych::alpha(phq_full_t8_physio_df)

```

## PHQ - Anxiety

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_anxiety_t5_physio = rowSums(select(., phq_1_t5_physio:phq_2_t5_physio)))

phq_anxiety_t5_physio_df <- physio_merged_raw %>% 
  select(phq_1_t5_physio:phq_2_t5_physio)

psych::alpha(phq_anxiety_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_anxiety_t7_physio = rowSums(select(., phq_1_t7_physio:phq_2_t7_physio)))

phq_anxiety_t7_physio_df <- physio_merged_raw %>% 
  select(phq_1_t7_physio:phq_2_t7_physio)

psych::alpha(phq_anxiety_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_anxiety_t8_physio = rowSums(select(., phq_1_t8_physio:phq_2_t8_physio)))

phq_anxiety_t8_physio_df <- physio_merged_raw %>% 
  select(phq_1_t8_physio:phq_2_t8_physio)

psych::alpha(phq_anxiety_t8_physio_df)

```

## PHQ - Depression

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_depression_t5_physio = rowSums(select(., phq_3_t5_physio:phq_4_t5_physio)))

phq_depression_t5_physio_df <- physio_merged_raw %>% 
  select(phq_3_t5_physio:phq_4_t5_physio)

psych::alpha(phq_depression_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_depression_t7_physio = rowSums(select(., phq_3_t7_physio:phq_4_t7_physio)))

phq_depression_t7_physio_df <- physio_merged_raw %>% 
  select(phq_3_t7_physio:phq_4_t7_physio)

psych::alpha(phq_depression_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(phq_depression_t8_physio = rowSums(select(., phq_3_t8_physio:phq_4_t8_physio)))

phq_depression_t8_physio_df <- physio_merged_raw %>% 
  select(phq_3_t8_physio:phq_4_t8_physio)

psych::alpha(phq_depression_t8_physio_df)

```

## Social Well-Being (MHC-SF Social Well-Being subscale)

### Rescale items

```{r}

# Rescale items from a 1-6 to a 0-5 scale

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(social_wellbeing_1_t5_physio:social_wellbeing_5_t5_physio), ~.-1))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(social_wellbeing_1_t7_physio:social_wellbeing_5_t7_physio), ~.-1))

physio_merged_raw <- physio_merged_raw %>% 
  mutate(across(c(social_wellbeing_1_t8_physio:social_wellbeing_5_t8_physio), ~.-1))

```

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(swb_t5_physio = rowSums(select(., social_wellbeing_1_t5_physio:social_wellbeing_5_t5_physio)))

swb_t5_physio_df <- physio_merged_raw %>% 
  select(social_wellbeing_1_t5_physio:social_wellbeing_5_t5_physio)

psych::alpha(swb_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(swb_t7_physio = rowSums(select(., social_wellbeing_1_t7_physio:social_wellbeing_5_t7_physio)))

swb_t7_physio_df <- physio_merged_raw %>% 
  select(social_wellbeing_1_t7_physio:social_wellbeing_5_t7_physio)

psych::alpha(swb_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(swb_t8_physio = rowSums(select(., social_wellbeing_1_t8_physio:social_wellbeing_5_t8_physio)))

swb_t8_physio_df <- physio_merged_raw %>% 
  select(social_wellbeing_1_t8_physio:social_wellbeing_5_t8_physio)

psych::alpha(swb_t8_physio_df)


```


## Global Health - Combined (Physical, Mental, QoL)

### Calculate summary scores

```{r}

str(physio_merged_raw, list.len = ncol(physio_merged_raw))

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(global_health_full_t5_physio = rowMeans(select(., global_health_base_1_t6_physio:global_health_base_3_t6_physio)))

global_health_full_t5_physio_df <- physio_merged_raw %>% 
  select(global_health_base_1_t6_physio:global_health_base_3_t6_physio)

psych::alpha(global_health_full_t5_physio_df)


# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(global_health_full_t7_physio = rowMeans(select(., global_wellbeing_1_t7_physio:global_wellbeing_3_t7_physio)))

global_health_full_t7_physio_df <- physio_merged_raw %>% 
  select(global_wellbeing_1_t7_physio:global_wellbeing_3_t7_physio)

psych::alpha(global_health_full_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(global_health_full_t8_physio = rowMeans(select(., global_wellbeing_1_t8_physio:global_wellbeing_3_t8_physio)))

global_health_full_t8_physio_df <- physio_merged_raw %>% 
  select(global_wellbeing_1_t8_physio:global_wellbeing_3_t8_physio)

psych::alpha(global_health_full_t8_physio_df)

```


## Meaning - Presence Subscale

### Reverse score items

```{r}

physio_merged_raw[ ,"meaning_base_6_t6_physio"] <- 8 - physio_merged_raw[ ,"meaning_base_6_t6_physio"]

physio_merged_raw[ ,"meaning_6_t7_physio"] <- 8 - physio_merged_raw[ ,"meaning_6_t7_physio"]

physio_merged_raw[ ,"meaning_6_t8_physio"] <- 8 - physio_merged_raw[ ,"meaning_6_t8_physio"]

```

### Calculate summary scores and alphas

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(meaning_presence_t5_physio = rowSums(select(., meaning_base_1_t6_physio, meaning_base_4_t6_physio:meaning_base_6_t6_physio)))

meaning_presence_t5_physio_df <- physio_merged_raw %>% 
  select(meaning_base_1_t6_physio, meaning_base_4_t6_physio:meaning_base_6_t6_physio)

psych::alpha(meaning_presence_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(meaning_presence_t7_physio = rowSums(select(., meaning_1_t7_physio, meaning_4_t7_physio:meaning_6_t7_physio)))

meaning_presence_t7_physio_df <- physio_merged_raw %>% 
  select(meaning_1_t7_physio, meaning_4_t7_physio:meaning_6_t7_physio)

psych::alpha(meaning_presence_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(meaning_presence_t8_physio = rowSums(select(., meaning_1_t8_physio, meaning_4_t8_physio:meaning_6_t8_physio)))

meaning_presence_t8_physio_df <- physio_merged_raw %>% 
  select(meaning_1_t8_physio, meaning_4_t8_physio:meaning_6_t8_physio)

psych::alpha(meaning_presence_t8_physio_df)



```

## Meaning - Search subscale

### Calculate summary scores and alphas

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(meaning_search_t5_physio = rowSums(select(.,meaning_base_2_t6_physio, meaning_base_3_t6_physio)))

meaning_search_t5_physio_df <- physio_merged_raw %>% 
  select(meaning_base_2_t6_physio, meaning_base_3_t6_physio)

psych::alpha(meaning_search_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(meaning_search_t7_physio = rowSums(select(., meaning_2_t7_physio, meaning_3_t7_physio)))

meaning_search_t7_physio_df <- physio_merged_raw %>% 
  select(meaning_2_t7_physio, meaning_3_t7_physio)

psych::alpha(meaning_search_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(meaning_search_t8_physio = rowSums(select(., meaning_2_t8_physio, meaning_3_t8_physio)))

meaning_search_t8_physio_df <- physio_merged_raw %>% 
  select(meaning_2_t8_physio, meaning_3_t8_physio)

psych::alpha(meaning_search_t8_physio_df)


```

## Resilience

### Reverse score items

```{r}

# T5

physio_merged_raw[ ,"resilience_base_2_t6_physio"] <- 6 - physio_merged_raw[ ,"resilience_base_2_t6_physio"]

physio_merged_raw[ ,"resilience_base_3_t6_physio"] <- 6 - physio_merged_raw[ ,"resilience_base_3_t6_physio"]

# T7

physio_merged_raw[ ,"resilience_2_t7_physio"] <- 6 - physio_merged_raw[ ,"resilience_2_t7_physio"]

physio_merged_raw[ ,"resilience_3_t7_physio"] <- 6 - physio_merged_raw[ ,"resilience_3_t7_physio"]

# T8

physio_merged_raw[ ,"resilience_2_t8_physio"] <- 6 - physio_merged_raw[ ,"resilience_2_t8_physio"]

physio_merged_raw[ ,"resilience_3_t8_physio"] <- 6 - physio_merged_raw[ ,"resilience_3_t8_physio"]


```

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(resilience_t5_physio = rowMeans(select(.,resilience_base_1_t6_physio:resilience_base_4_t6_physio)))

resilience_t5_physio_df <- physio_merged_raw %>% 
  select(resilience_base_1_t6_physio:resilience_base_4_t6_physio)

psych::alpha(resilience_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(resilience_t7_physio = rowMeans(select(.,resilience_1_t7_physio:resilience_4_t7_physio)))

resilience_t7_physio_df <- physio_merged_raw %>% 
  select(resilience_1_t7_physio:resilience_4_t7_physio)

psych::alpha(resilience_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(resilience_t8_physio = rowMeans(select(.,resilience_1_t8_physio:resilience_4_t8_physio)))

resilience_t8_physio_df <- physio_merged_raw %>% 
  select(resilience_1_t8_physio:resilience_4_t8_physio)

psych::alpha(resilience_t8_physio_df)


```

## Closeness

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>% 
  mutate(closeness_t5_physio = rowSums(select(.,closeness_base_1_t6_physio:closeness_base_4_t6_physio)))

closeness_t5_physio_df <- physio_merged_raw %>% 
  select(closeness_base_1_t6_physio:closeness_base_4_t6_physio)

psych::alpha(closeness_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>% 
  mutate(closeness_t7_physio = rowSums(select(.,closeness_1_t7_physio:closeness_4_t7_physio)))

closeness_t7_physio_df <- physio_merged_raw %>% 
  select(closeness_1_t7_physio:closeness_4_t7_physio)

psych::alpha(closeness_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>% 
  mutate(closeness_t8_physio = rowSums(select(.,closeness_1_t8_physio:closeness_4_t8_physio)))

closeness_t8_physio_df <- physio_merged_raw %>% 
  select(closeness_1_t8_physio:closeness_4_t8_physio)

psych::alpha(closeness_t8_physio_df)


```

## Stress Mindset

### Rescale items

```{r}

# Rescale items from a 1-5 to a 0-4 scale

# T5

physio_merged_raw <- physio_merged_raw %>%
  mutate(across(c(stress_mindset_1_t5_physio:stress_mindset_4_t5_physio), ~.-1))

# T7

physio_merged_raw <- physio_merged_raw %>%
  mutate(across(c(stress_mindset_1_t7_physio:stress_mindset_4_t7_physio), ~.-1))

# T8

physio_merged_raw <- physio_merged_raw %>%
  mutate(across(c(stress_mindset_1_t8_physio:stress_mindset_4_t8_physio), ~.-1))

```

### Reverse score items

```{r}

# Reverse score questions 1 and 3

# T5

physio_merged_raw[ ,'stress_mindset_1_t5_physio'] <- 4 - physio_merged_raw[ ,'stress_mindset_1_t5_physio']
physio_merged_raw[ ,'stress_mindset_3_t5_physio'] <- 4 - physio_merged_raw[ ,'stress_mindset_3_t5_physio']

# T7

physio_merged_raw[ ,'stress_mindset_1_t7_physio'] <- 4 - physio_merged_raw[ ,'stress_mindset_1_t7_physio']
physio_merged_raw[ ,'stress_mindset_3_t7_physio'] <- 4 - physio_merged_raw[ ,'stress_mindset_3_t7_physio']

#T7

physio_merged_raw[ ,'stress_mindset_1_t8_physio'] <- 4 - physio_merged_raw[ ,'stress_mindset_1_t8_physio']
physio_merged_raw[ ,'stress_mindset_3_t8_physio'] <- 4 - physio_merged_raw[ ,'stress_mindset_3_t8_physio']

```

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>%
  mutate(stress_mindset_t5_physio = rowMeans(select(.,stress_mindset_1_t5_physio:stress_mindset_4_t5_physio)))

stress_mindset_t5_physio_df <- physio_merged_raw %>%
  select(stress_mindset_1_t5_physio:stress_mindset_4_t5_physio)

psych::alpha(stress_mindset_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>%
  mutate(stress_mindset_t7_physio = rowMeans(select(.,stress_mindset_1_t7_physio:stress_mindset_4_t7_physio)))

stress_mindset_t7_physio_df <- physio_merged_raw %>%
  select(stress_mindset_1_t7_physio:stress_mindset_4_t7_physio)

psych::alpha(stress_mindset_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>%
  mutate(stress_mindset_t8_physio = rowMeans(select(.,stress_mindset_1_t8_physio:stress_mindset_4_t8_physio)))

stress_mindset_t8_physio_df <- physio_merged_raw %>%
  select(stress_mindset_1_t8_physio:stress_mindset_4_t8_physio)

psych::alpha(stress_mindset_t8_physio_df)

```

## Well-Being Growth Mindset

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>%
  mutate(growth_mindset_t5_physio = rowMeans(select(.,growth_mindset_1_t5_physio:growth_mindset_3_t5_physio)))

growth_mindset_t5_physio_df <- physio_merged_raw %>%
  select(growth_mindset_1_t5_physio:growth_mindset_3_t5_physio)

psych::alpha(growth_mindset_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>%
  mutate(growth_mindset_t7_physio = rowMeans(select(.,growth_mindset_1_t7_physio:growth_mindset_3_t7_physio)))

growth_mindset_t7_physio_df <- physio_merged_raw %>%
  select(growth_mindset_1_t7_physio:growth_mindset_3_t7_physio)

psych::alpha(growth_mindset_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>%
  mutate(growth_mindset_t8_physio = rowMeans(select(.,growth_mindset_1_t8_physio:growth_mindset_3_t8_physio)))

growth_mindset_t8_physio_df <- physio_merged_raw %>%
  select(growth_mindset_1_t8_physio:growth_mindset_3_t8_physio)

psych::alpha(growth_mindset_t8_physio_df)


```

## Cognitive Flexibility

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>%
  mutate(cog_flexibility_t5_physio = rowMeans(select(.,cog_flexibility_1_t5_physio:cog_flexibility_12_t5_physio)))

cog_flexibility_t5_physio_df <- physio_merged_raw %>%
  select(cog_flexibility_1_t5_physio:cog_flexibility_12_t5_physio)

psych::alpha(cog_flexibility_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>%
  mutate(cog_flexibility_t7_physio = rowMeans(select(.,cog_flexibility_1_t7_physio:cog_flexibility_12_t7_physio)))

cog_flexibility_t7_physio_df <- physio_merged_raw %>%
  select(cog_flexibility_1_t7_physio:cog_flexibility_12_t7_physio)

psych::alpha(cog_flexibility_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>%
  mutate(cog_flexibility_t8_physio = rowMeans(select(.,cog_flexibility_1_t8_physio:cog_flexibility_12_t8_physio)))

cog_flexibility_t8_physio_df <- physio_merged_raw %>%
  select(cog_flexibility_1_t8_physio:cog_flexibility_12_t8_physio)

psych::alpha(cog_flexibility_t8_physio_df)

```

## Primal World-Beliefs

### Rescale items

```{r}

# Rescale items from a 1-6 to a 0-5 scale

# T5

physio_merged_raw <- physio_merged_raw %>%
  mutate(across(c(primals_1_t5_physio:primals_6_t5_physio), ~.-1))

# T7

physio_merged_raw <- physio_merged_raw %>%
  mutate(across(c(primals_1_t7_physio:primals_6_t7_physio), ~.-1))

# T8

physio_merged_raw <- physio_merged_raw %>%
  mutate(across(c(primals_1_t8_physio:primals_6_t8_physio), ~.-1))

```

### Reverse score items

```{r}

# Reverse score questions 3, 4, and 6

# T5

physio_merged_raw[ ,'primals_3_t5_physio'] <- 5 - physio_merged_raw[ ,'primals_3_t5_physio']
physio_merged_raw[ ,'primals_4_t5_physio'] <- 5 - physio_merged_raw[ ,'primals_4_t5_physio']
physio_merged_raw[ ,'primals_6_t5_physio'] <- 5 - physio_merged_raw[ ,'primals_6_t5_physio']

# T7

physio_merged_raw[ ,'primals_3_t7_physio'] <- 5 - physio_merged_raw[ ,'primals_3_t7_physio']
physio_merged_raw[ ,'primals_4_t7_physio'] <- 5 - physio_merged_raw[ ,'primals_4_t7_physio']
physio_merged_raw[ ,'primals_6_t7_physio'] <- 5 - physio_merged_raw[ ,'primals_6_t7_physio']

#T8

physio_merged_raw[ ,'primals_3_t8_physio'] <- 5 - physio_merged_raw[ ,'primals_3_t8_physio']
physio_merged_raw[ ,'primals_4_t8_physio'] <- 5 - physio_merged_raw[ ,'primals_4_t8_physio']
physio_merged_raw[ ,'primals_6_t8_physio'] <- 5 - physio_merged_raw[ ,'primals_6_t8_physio']


```

### Calculate summary scores

```{r}

# T5

physio_merged_raw <- physio_merged_raw %>%
  mutate(primals_t5_physio = rowMeans(select(.,primals_1_t5_physio:primals_6_t5_physio)))

primals_t5_physio_df <- physio_merged_raw %>%
  select(primals_1_t5_physio:primals_6_t5_physio)

psych::alpha(primals_t5_physio_df)

# T7

physio_merged_raw <- physio_merged_raw %>%
  mutate(primals_t7_physio = rowMeans(select(.,primals_1_t7_physio:primals_6_t7_physio)))

primals_t7_physio_df <- physio_merged_raw %>%
  select(primals_1_t7_physio:primals_6_t7_physio)

psych::alpha(primals_t7_physio_df)

# T8

physio_merged_raw <- physio_merged_raw %>%
  mutate(primals_t8_physio = rowMeans(select(.,primals_1_t8_physio:primals_6_t8_physio)))

primals_t8_physio_df <- physio_merged_raw %>%
  select(primals_1_t8_physio:primals_6_t8_physio)

psych::alpha(primals_t8_physio_df)

```


# Make and export identifying key

```{r}

# Add participant_id column

physio_merged_raw <- id_key %>% 
  select(participant_id, RecipientEmail) %>% 
  inner_join(physio_merged_raw, by = "RecipientEmail")


# Make identifying key

physio_id_key <- physio_merged_raw %>% 
  select(participant_id, RecipientEmail, Status_t5_physio, Progress_t5_physio, Finished_t5_physio, StartDate_t5_physio, EndDate_t5_physio, duration_t5_physio,
         Finished_t5_physio, RecipientLastName_t5_physio,
         RecipientFirstName_t5_physio, LocationLatitude_t5_physio, LocationLongitude_t5_physio, hipaa_authorization_1_t5_physio,
         hipaa_authorization_2_t5_physio, first_name_t5_physio, last_name_t5_physio, address_t5_physio, apartment_t5_physio,
         city_t5_physio, state_t5_physio, zipcode_t5_physio, text.agreement_t5_physio, phone.number_t5_physio, Status_t6_physio, Progress_t6_physio, Finished_t6_physio,  StartDate_t6_physio, EndDate_t6_physio,
         duration_t6_physio, Finished_t6_physio, RecipientFirstName_t6_physio, RecipientLastName_t6_physio, LocationLatitude_t6_physio, LocationLongitude_t6_physio, Status_t7_physio, Progress_t7_physio, Finished_t7_physio, StartDate_t7_physio, EndDate_t7_physio, duration_t7_physio, 
         Finished_t7_physio, RecipientFirstName_t7_physio, RecipientLastName_t7_physio, LocationLatitude_t7_physio, LocationLongitude_t7_physio, Status_t8_physio, Progress_t8_physio, Finished_t8_physio, StartDate_t8_physio, EndDate_t8_physio, duration_t8_physio, Finished_t8_physio,
         RecipientFirstName_t8_physio, RecipientLastName_t8_physio, LocationLatitude_t8_physio, LocationLongitude_t8_physio
         )

# Remove unnecessary data from physio_merged

physio_merged_raw <- physio_merged_raw %>% 
  select(-c(Status_t5_physio, Progress_t5_physio, Finished_t5_physio, StartDate_t5_physio, duration_t5_physio, EndDate_t5_physio, RecipientLastName_t5_physio,
         RecipientFirstName_t5_physio, LocationLatitude_t5_physio, LocationLongitude_t5_physio, hipaa_authorization_1_t5_physio,
         hipaa_authorization_2_t5_physio, first_name_t5_physio, last_name_t5_physio, address_t5_physio, apartment_t5_physio,
         city_t5_physio, state_t5_physio, zipcode_t5_physio, text.agreement_t5_physio, phone.number_t5_physio, Status_t6_physio, Progress_t6_physio, Finished_t6_physio, duration_t6_physio, StartDate_t6_physio, EndDate_t6_physio,
         RecipientFirstName_t6_physio, RecipientLastName_t6_physio, LocationLatitude_t6_physio, LocationLongitude_t6_physio,
         con_vid_1_time_First.Click_t6_physio:con_vid_2_time_Click.Count_t6_physio, 
         con_vid_3_time_First.Click_t6_physio:con_vid_3_time_Click.Count_t6_physio,
         con_vid_4_time_First.Click_t6_physio:con_vid_4_time_Click.Count_t6_physio,
         con_vid_5_time_First.Click_t6_physio:con_vid_5_time_Click.Count_t6_physio,
         Part.1.Vid.1.Timing_First.Click_t6_physio:Part.1.Vid.1.Timing_Click.Count_t6_physio,
         Part.1.Vid.2.Timing_First.Click_t6_physio:Part.1.Vid.2.Timing_Click.Count_t6_physio,
         Step.2.Vid.1.Time_First.Click_t6_physio:Step.2.Vid.1.Time_Click.Count_t6_physio,
         Part.2.Vid.2.Timing_First.Click_t6_physio:Part.2.Vid.2.Timing_Click.Count_t6_physio,
         Step.2.Vid.3.Time_First.Click_t6_physio:Step.2.Vid.3.Time_Click.Count_t6_physio,
         Status_t7_physio, Progress_t7_physio, Finished_t7_physio, duration_t7_physio, StartDate_t7_physio, EndDate_t7_physio, RecipientFirstName_t7_physio, RecipientLastName_t7_physio, LocationLatitude_t7_physio, LocationLongitude_t7_physio, Status_t8_physio, Progress_t8_physio, Finished_t8_physio, duration_t8_physio, StartDate_t8_physio, EndDate_t8_physio,
         RecipientFirstName_t8_physio, RecipientLastName_t8_physio, LocationLatitude_t8_physio, LocationLongitude_t8_physio))


```





# Write ID key to Box

```{r}

write.csv(physio_id_key, "/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/ROTP + Physio Preprocessing/ROTP_Physio_ID_Key.csv")

```

Write merged raw dataset to Box

```{r}

write.csv(physio_merged_raw, "/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/ROTP + Physio Preprocessing/Preprocessed Data/ROTP_Physio_Summaries.csv")


```


### Rescale items SFMM

```{r}

# Rescale items from a 1-6 to a 0-5 scale

physio_preprocessed_sum <- physio_preprocessed_sum %>% 
  mutate(across(c(sfmm_1_t5_physio:sfmm_3_t5_physio), ~.-1))

##NAs in T7 and T8 do not allow for transformation - imputing NAs with 999 and then replacing with NA once finished

#T7 
physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t7_physio:sfmm_3_t7_physio), ~ ifelse(. == "NA", 999, .)))

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t7_physio:sfmm_3_t7_physio), as.numeric))

physio_preprocessed_sum <- physio_preprocessed_sum %>% 
  mutate(across(c(sfmm_1_t7_physio:sfmm_3_t7_physio), ~.-1))

#T8

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t8_physio:sfmm_3_t8_physio), ~ ifelse(. == "NA", 999, .)))

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t8_physio:sfmm_3_t8_physio), as.numeric))

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t8_physio:sfmm_3_t8_physio), ~ . - 1))


```



### Calculate summary scores SFMM

```{r}

# T5

physio_preprocessed_sum  <- physio_preprocessed_sum  %>% 
  mutate(sfmm_t5_physio = rowSums(select(., sfmm_1_t5_physio:sfmm_3_t5_physio)))

sfmm_t5_physio_df <- physio_preprocessed_sum %>% 
  select(sfmm_1_t5_physio:sfmm_3_t5_physio)

psych::alpha(sfmm_t5_physio_df)

# T7

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(sfmm_t7_physio = rowSums(select(., sfmm_1_t7_physio:sfmm_3_t7_physio)))

sfmm_t7_physio_df <- physio_preprocessed_sum %>%
  select(sfmm_1_t7_physio:sfmm_3_t7_physio)

psych::alpha(sfmm_t7_physio_df)


# T8

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(sfmm_t8_physio = rowSums(select(., sfmm_1_t8_physio:sfmm_3_t8_physio)))

sfmm_t8_physio_df <- physio_preprocessed_sum %>%
  select(sfmm_1_t8_physio:sfmm_3_t8_physio)

psych::alpha(sfmm_t8_physio_df)


```


SFMM Replace NA values in T7 & T8 

```{r}

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t7_physio:sfmm_3_t7_physio), ~ na_if(., 999)))


physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_1_t8_physio:sfmm_3_t8_physio), ~ na_if(., 999)))


#


physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_t7_physio), ~ na_if(., 2994)))


physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(sfmm_t8_physio), ~ na_if(., 2994)))



```




### Rescale items for CMM

```{r}

# Rescale items from a 1-6 to a 0-5 scale

physio_preprocessed_sum <- physio_preprocessed_sum %>% 
  mutate(across(c(cmm_1_t5_physio:cmm_4_t5_physio), ~.-1))


##NAs in T7 and T8 do not allow for transformation - imputing NAs with 999 and then replacing with NA once finished

#T7 
physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(cmm_1_t7_physio:cmm_4_t7_physio), ~ ifelse(. == "NA", 999, .)))

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(cmm_1_t7_physio:cmm_4_t7_physio), as.numeric))

physio_preprocessed_sum <- physio_preprocessed_sum %>% 
  mutate(across(c(cmm_1_t7_physio:cmm_4_t7_physio), ~.-1))

#T8

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(cmm_1_t8_physio:cmm_4_t8_physio), ~ ifelse(. == "NA", 999, .)))

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(cmm_1_t8_physio:cmm_4_t8_physio), as.numeric))

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(across(c(cmm_1_t8_physio:cmm_4_t8_physio), ~ . - 1))


```



Reverse Scoring CMM

```{r}
#T5 Reverse Scoring 

cmm_reverse_columns_t5 <- physio_preprocessed_sum%>% 
  select(cmm_1_t8_physio:cmm_4_t8_physio) %>% 
  colnames()


physio_preprocessed_sum [ ,cmm_reverse_columns_t5] = 7 - physio_preprocessed_sum [ , cmm_reverse_columns_t5]


#T7 Reverse Scoring

cmm_reverse_columns_t7 <- physio_preprocessed_sum%>% 
  select(cmm_1_t7_physio:cmm_4_t7_physio) %>% 
  colnames()


physio_preprocessed_sum [ ,cmm_reverse_columns_t7] = 7 - physio_preprocessed_sum [ , cmm_reverse_columns_t7]


#T8 Reverse Scoring

cmm_reverse_columns_t8 <- physio_preprocessed_sum%>% 
  select(cmm_1_t8_physio:cmm_4_t8_physio) %>% 
  colnames()


physio_preprocessed_sum [ ,cmm_reverse_columns_t8] = 7 - physio_preprocessed_sum [ , cmm_reverse_columns_t8]


```




Calculate summary scores CMM

```{r}

# T5 CMM Mean-Based Summary Score

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(cmm_t5_physio = rowMeans(select(., cmm_1_t5_physio:cmm_4_t5_physio)))

# T7  CMM Mean-Based Summary Score

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(cmm_t7_physio = rowMeans(select(., cmm_1_t7_physio:cmm_4_t7_physio)))

# T8  CMM Mean-Based Summary Score

physio_preprocessed_sum <- physio_preprocessed_sum %>%
  mutate(cmm_t8_physio = rowMeans(select(., cmm_1_t8_physio:cmm_4_t8_physio)))

```


Calculate Alphas CMM (Sum-Based)
```{r}

#T5 

cmm_t5_physio_sum_alpha_df  <- physio_preprocessed_sum  %>% 
  mutate(cmm_t5_physio = rowSums(select(., cmm_1_t5_physio:cmm_4_t5_physio)))

cmm_t5_physio_sum_alpha_df <- physio_preprocessed_sum %>%
  select(cmm_1_t5_physio:cmm_4_t5_physio)


psych::alpha(cmm_t5_physio_sum_alpha_df)


#T7 

cmm_t7_physio_sum_alpha_df  <- physio_preprocessed_sum  %>% 
  mutate(cmm_t7_physio = rowSums(select(., cmm_1_t7_physio:cmm_4_t7_physio)))

cmm_t7_physio_sum_alpha_df <- physio_preprocessed_sum %>%
  select(cmm_1_t7_physio:cmm_4_t7_physio)


psych::alpha(cmm_t7_physio_sum_alpha_df)



#T8

cmm_t8_physio_sum_alpha_df  <- physio_preprocessed_sum  %>% 
  mutate(cmm_t8_physio = rowSums(select(., cmm_1_t8_physio:cmm_4_t8_physio)))

cmm_t8_physio_sum_alpha_df <- physio_preprocessed_sum %>%
  select(cmm_1_t8_physio:cmm_4_t8_physio)


psych::alpha(cmm_t8_physio_sum_alpha_df)

```




