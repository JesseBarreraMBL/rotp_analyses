---
title: "ROTP Analyses"
author: "Jesse Barrera"
output: html_document
date: "2023-05-06"
---

```{r}


knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```


# Load packages

```{r}

library (readr)
library(dplyr)
library(psych)
library(lubridate)
library(mice)
library(tidyr)
library(lme4)
library(jtools)
library(sjPlot)
library(ggplot2)
library(GGally)
library(haven)
library(stats)
library(mice)
library(broom.mixed)
library(utils)
library(ggeffects)

```

# Import data

```{r}

setwd("/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/Preprocessed Data")

merged_deidentified_long <- read.csv("merged_long_deidentified.csv")

```

# Primary Analyses

## Examine correlations between CO mindset and outcome variables

```{r  setup, warning=FALSE}

# T5

merged_deidentified_long_t1 <- merged_deidentified_long %>% 
  filter(timepoint == 1) 

ggpairs(merged_deidentified_long_t1, 34:56, progress = FALSE)
  
# T6

rotp_behavioral_long_t6 <- rotp_behavioral_long %>% 
  filter(timepoint == 6)

ggpairs(rotp_behavioral_long_t6, 157:170, progress = FALSE) 

# T7

rotp_behavioral_long_t7 <- rotp_behavioral_long %>% 
  filter(timepoint == 7)

ggpairs(rotp_behavioral_long_t7, 157:170, progress = FALSE)

# T8

rotp_behavioral_long_t8 <- rotp_behavioral_long %>% 
  filter(timepoint == 8)

rotp_behavioral_long %>% 
  ggpairs(157:170, progress = FALSE)

ggpairs(rotp_behavioral_long_t8, 157:170, progress = FALSE)


```

## Examine correlations between CO mindset, PTG, depression, and biomarkers

```{r warning=FALSE}

# T5

rotp_behavioral_physio_adj_t1 <- rotp_behavioral_physio_adj %>% 
  filter(timepoint == 1) %>% 
  filter(branch == "physio") %>% 
  select(c(participant_id, timepoint, co_mindset, ptgi_full, phq_depression, IL6._Log2Transformed, IL10_Log2Transformed, IL1B_Log2Transformed, TNFA_Log2Transformed, CRP_Log2Transformed)) 


ggpairs(rotp_behavioral_physio_adj_t1, 3:10, progress = FALSE)

# T7

rotp_behavioral_physio_adj_t2 <- rotp_behavioral_physio_adj %>% 
  filter(timepoint == 2) %>% 
  filter(branch == "physio") %>% 
  select(c(participant_id, timepoint, co_mindset, ptgi_full, phq_depression, IL6._Log2Transformed, IL10_Log2Transformed, IL1B_Log2Transformed, TNFA_Log2Transformed, CRP_Log2Transformed)) 


ggpairs(rotp_behavioral_physio_adj_t2, 3:10, progress = FALSE)

# T8

rotp_behavioral_physio_adj_t3 <- rotp_behavioral_physio_adj %>% 
  filter(timepoint == 3) %>% 
  filter(branch == "physio") %>% 
  select(c(participant_id, timepoint, co_mindset, ptgi_full, phq_depression, IL6._Log2Transformed, IL10_Log2Transformed, IL1B_Log2Transformed, TNFA_Log2Transformed, CRP_Log2Transformed)) 


ggpairs(rotp_behavioral_physio_adj_t3, 3:10, progress = FALSE)


```

# Visualize descriptives

## Visualize means for outcome variables by demographics and condition

### CO Mindset - Visualize Descriptives

```{r}

# Gender

## Create simplified dataframe without participants with gender = NA, and only including T1, T3, and T4

gender_simplified <- merged_deidentified_long %>% 
  filter(gender == "Man" | gender == "Woman" | gender == "Non-Binary") %>% 
  filter(timepoint != 2)

# Visualize CO mindset x gender, collapsed across conditions

ggplot(gender_simplified, aes(x = timepoint, y = co_mindset, fill = gender)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Gender", y = "Mean of CO Mindset") 

# Visualize CO mindset x gender, separated by condition

ggplot(gender_simplified, aes(x = timepoint, y = co_mindset, fill = gender)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Gender", y = "Mean of CO Mindset") + 
  facet_grid(rows = vars(condition))

# Race_ethnicity

## Create simplified dataframe without participants with race_ethnicity = NA, and only including T1, T3, and T4

race_ethnicity_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(race_ethnicity))) %>% 
  filter(timepoint != 2)

# Visualize CO mindset x race_ethnicity, collapsed across conditions

ggplot(race_ethnicity_simplified, aes(x = timepoint, y = co_mindset, fill = race_ethnicity)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Timepoint", y = "Mean of CO Mindset") 

# Visualize CO mindset x race_ethnicity, separated by condition

ggplot(race_ethnicity_simplified, aes(x = timepoint, y = co_mindset, fill = race_ethnicity)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Timepoint", y = "Mean of CO Mindset") + 
  facet_grid(rows = vars(condition))
  
# Education

## Create simplified dataframe without participants with education = NA, and only including T1, T3, and T4

education_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(education))) %>% 
  filter(timepoint != 2)

# Visualize CO mindset x education, collapsed across conditions

ggplot(education_simplified, aes(x = timepoint, y = co_mindset, fill = education)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Timepoint", y = "Mean of CO Mindset") 

# Visualize CO mindset x education, separated by condition

ggplot(education_simplified, aes(x = timepoint, y = co_mindset, fill = education)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Timepoint", y = "Mean of CO Mindset") + 
  facet_grid(rows = vars(condition))

# Political Party

political_party_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(political_party))) %>% 
  filter(timepoint != 2)

# Visualize CO mindset x political_party, collapsed across conditions

ggplot(political_party_simplified, aes(x = timepoint, y = co_mindset, fill = political_party)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Timepoint", y = "Mean of CO Mindset") 

# Visualize CO mindset x political_party, separated by condition

ggplot(political_party_simplified, aes(x = timepoint, y = co_mindset, fill = political_party)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(1,7)) +
  labs(x = "Timepoint", y = "Mean of CO Mindset") + 
  facet_grid(rows = vars(condition))

# Pandemic-related hardships

# Simplify dataframe to remove timepoints at which prh was not collected 

prh_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(prh))) %>% 
  filter(timepoint != 2,
         timepoint != 3)

# Visualize CO mindset x prh, separated by timepoint

ggplot(prh_simplified, aes(x = prh, y = co_mindset, color = condition)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  coord_cartesian(ylim = c(1,7), xlim = c(10,40)) +
  labs(x = "Pandemic-related hardships", y = "CO Mindset") +
  facet_grid(rows = vars(timepoint))



```

# PTG - Full

```{r}

# Gender

## Create simplified dataframe without participants with gender = NA, and only including T1, T3, and T4

gender_simplified <- merged_deidentified_long %>% 
  filter(gender == "Man" | gender == "Woman" | gender == "Non-Binary") %>% 
  filter(timepoint != 2)

# Visualize CO mindset x gender, collapsed across conditions

ggplot(gender_simplified, aes(x = timepoint, y = ptgi_full, fill = gender)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Gender", y = "Mean of PHQ-Depression") 

# Visualize CO mindset x gender, separated by condition

ggplot(gender_simplified, aes(x = timepoint, y = ptgi_full, fill = gender)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Gender", y = "Mean of PHQ-Depression") + 
  facet_grid(rows = vars(condition))

# Race_ethnicity

## Create simplified dataframe without participants with race_ethnicity = NA, and only including T1, T3, and T4

race_ethnicity_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(race_ethnicity))) %>% 
  filter(timepoint != 2)

# Visualize ptgi_full x race_ethnicity, collapsed across conditions

ggplot(race_ethnicity_simplified, aes(x = timepoint, y = ptgi_full, fill = race_ethnicity)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Timepoint", y = "Mean of ptgi_full") 

# Visualize ptgi_full x race_ethnicity, separated by condition

ggplot(race_ethnicity_simplified, aes(x = timepoint, y = ptgi_full, fill = race_ethnicity)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Timepoint", y = "Mean of ptgi_full") + 
  facet_grid(rows = vars(condition))
  
# Education

## Create simplified dataframe without participants with education = NA, and only including T1, T3, and T4

education_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(education))) %>% 
  filter(timepoint != 2)

# Visualize ptgi_full x education, collapsed across conditions

ggplot(education_simplified, aes(x = timepoint, y = ptgi_full, fill = education)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Timepoint", y = "Mean of ptgi_full") 

# Visualize ptgi_full x education, separated by condition

ggplot(education_simplified, aes(x = timepoint, y = ptgi_full, fill = education)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Timepoint", y = "Mean of ptgi_full") + 
  facet_grid(rows = vars(condition))

# Political Party

political_party_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(political_party))) %>% 
  filter(timepoint != 2)

# Visualize ptgi_full x political_party, collapsed across conditions

ggplot(political_party_simplified, aes(x = timepoint, y = ptgi_full, fill = political_party)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Timepoint", y = "Mean of ptgi_full") 

# Visualize ptgi_full x political_party, separated by condition

ggplot(political_party_simplified, aes(x = timepoint, y = ptgi_full, fill = political_party)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,105)) +
  labs(x = "Timepoint", y = "Mean of ptgi_full") + 
  facet_grid(rows = vars(condition))

# Pandemic-related hardships

# Simplify dataframe to remove timepoints at which prh was not collected 

prh_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(prh))) %>% 
  filter(timepoint != 2,
         timepoint != 3)

# Visualize ptgi_full x prh, separated by timepoint

ggplot(prh_simplified, aes(x = prh, y = ptgi_full, color = condition)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  coord_cartesian(ylim = c(0,105), xlim = c(10,40)) +
  labs(x = "Pandemic-related hardships", y = "ptgi_full") +
  facet_grid(rows = vars(timepoint))



```

# PHQ-Depression

```{r}


# Gender

## Create simplified dataframe without participants with gender = NA, and only including T1, T3, and T4

gender_simplified <- merged_deidentified_long %>% 
  filter(gender == "Man" | gender == "Woman" | gender == "Non-Binary") %>% 
  filter(timepoint != 2)

# Visualize CO mindset x gender, collapsed across conditions

ggplot(gender_simplified, aes(x = timepoint, y = phq_depression, fill = gender)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Gender", y = "Mean of PHQ-Depression") 

# Visualize CO mindset x gender, separated by condition

ggplot(gender_simplified, aes(x = timepoint, y = phq_depression, fill = gender)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Gender", y = "Mean of PHQ-Depression") + 
  facet_grid(rows = vars(condition))

# Race_ethnicity

## Create simplified dataframe without participants with race_ethnicity = NA, and only including T1, T3, and T4

race_ethnicity_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(race_ethnicity))) %>% 
  filter(timepoint != 2)

# Visualize phq_depression x race_ethnicity, collapsed across conditions

ggplot(race_ethnicity_simplified, aes(x = timepoint, y = phq_depression, fill = race_ethnicity)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Timepoint", y = "Mean of phq_depression") 

# Visualize phq_depression x race_ethnicity, separated by condition

ggplot(race_ethnicity_simplified, aes(x = timepoint, y = phq_depression, fill = race_ethnicity)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Timepoint", y = "Mean of phq_depression") + 
  facet_grid(rows = vars(condition))
  
# Education

## Create simplified dataframe without participants with education = NA, and only including T1, T3, and T4

education_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(education))) %>% 
  filter(timepoint != 2)

# Visualize phq_depression x education, collapsed across conditions

ggplot(education_simplified, aes(x = timepoint, y = phq_depression, fill = education)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Timepoint", y = "Mean of phq_depression") 

# Visualize phq_depression x education, separated by condition

ggplot(education_simplified, aes(x = timepoint, y = phq_depression, fill = education)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Timepoint", y = "Mean of phq_depression") + 
  facet_grid(rows = vars(condition))

# Political Party

political_party_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(political_party))) %>% 
  filter(timepoint != 2)

# Visualize phq_depression x political_party, collapsed across conditions

ggplot(political_party_simplified, aes(x = timepoint, y = phq_depression, fill = political_party)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Timepoint", y = "Mean of phq_depression") 

# Visualize phq_depression x political_party, separated by condition

ggplot(political_party_simplified, aes(x = timepoint, y = phq_depression, fill = political_party)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  coord_cartesian(ylim = c(0,6)) +
  labs(x = "Timepoint", y = "Mean of phq_depression") + 
  facet_grid(rows = vars(condition))

# Pandemic-related hardships

# Simplify dataframe to remove timepoints at which prh was not collected 

prh_simplified <- merged_deidentified_long %>% 
  filter(!(is.na(prh))) %>% 
  filter(timepoint != 2,
         timepoint != 3)

# Visualize phq_depression x prh, separated by timepoint

ggplot(prh_simplified, aes(x = prh, y = phq_depression, color = condition)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  coord_cartesian(ylim = c(0,6), xlim = c(10,40)) +
  labs(x = "Pandemic-related hardships", y = "phq_depression") +
  facet_grid(rows = vars(timepoint))




```


## CO Mindset - Mixed Model

```{r}

com.mm <- lmer(co_mindset ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long)

str(merged_deidentified_long$timepoint)

summ(com.mm)

sjPlot::tab_model(com.mm)


# Plot model

plot_model(com.mm)

ggplot(rotp_behavioral_adj_123, aes(x = as.numeric(timepoint), y = co_mindset, color = condition)) +
geom_point(alpha = 0.5, size = 1, position = position_jitter(width = 0.1)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of Catastrophes Mindset Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("CO Mindset (Mean)", limits = 1:7, labels = 1:7) +
theme_minimal()

View(rotp_behavioral_adj)

# Addtional plot models

ggplot(rotp_behavioral_adj_123, aes(x = timepoint, y = co_mindset, group = condition, color = condition)) +
geom_point() +
stat_summary(fun = median, geom = "line", size = 1.5) +
labs(title = "Catastrophes Mindset Across Time") +
scale_x_discrete("Timepoint", limits = 1:4, labels = 1:4) +
scale_y_discrete("CO Mindset", limits = 1:7, labels = 1:7) +
theme_minimal()





ggplot(rotp_behavioral_long, aes(x = as.numeric(timepoint), y = co_mindset, color = condition)) +
  geom_point() + 
  geom_smooth(method = "lm")

```

## PTG Full - Mixed Model

```{r}

merged_deidentified_long_t5_t7_t8 <- merged_deidentified_long %>% 
  filter(timepoint != 6)


ptg_full.mm <- lmer(ptgi_full ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_full.mm)

sjPlot::tab_model(ptg_full.mm)


# Plot model

plot_model(ptg_full.mm)

ggplot(merged_deidentified_long_t5_t7_t8, aes(x = as.numeric(timepoint), y = ptgi_full, color = condition)) +
geom_point(alpha = 0.5, size = 1, position = position_jitter(width = 0.1)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of PTG Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PTGI-Full (Mean)", limits = 0:5, labels = 0:5) +
theme_minimal()



# Additional plots

ggplot(rotp_behavioral_adj, aes(x = timepoint, y = ptgi_full, group = condition, color = condition)) +
geom_point() +
stat_summary(fun = median, geom = "line", size = 1.5) +
labs(title = "Post-Traumatic Growth Across Time") +
scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PTGI-Full", limits = 0:5, labels = 0:5) +
theme_minimal()




```


## PTG Abridged - Mixed Model

```{r}

ptg_abridged.mm <- lmer(ptgi_abridged ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_abridged.mm)

sjPlot::tab_model(ptg_abridged.mm)


# Plot model

plot_model(ptg_abridged.mm)

ggplot(rotp_behavioral_long, aes(x = timepoint, y = ptgi_abridged, color = condition)) + 
  geom_smooth(method = "lm")

```

PTGI Relationships Subscale - Mixed Model

```{r}

ptg_relationships.mm <- lmer(ptgi_relationships ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_relationships.mm)

sjPlot::tab_model(ptg_relationships.mm)


# Plot model

plot_model(ptg_relationships.mm)

ggplot(merged_deidentified_long_t5_t7_t8, aes(x = timepoint, y = ptgi_relationships, color = condition)) +
  geom_boxplot() + 
  theme_bw()


```

PTGI Possibilities Subscale - Mixed Models

```{r}

ptg_possibilities.mm <- lmer(ptgi_possibilities ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_possibilities.mm)

sjPlot::tab_model(ptg_possibilities.mm)


# Plot model

plot_model(ptg_possibilities.mm)

ggplot(rotp_behavioral_long, aes(x = timepoint, y = ptgi_possibilities, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

PTGI Strength Subscale - Mixed Models

```{r}

ptg_strength.mm <- lmer(ptgi_strength ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_strength.mm)

sjPlot::tab_model(ptg_strength.mm)

ggplot(rotp_behavioral_adj_123, aes(x = as.numeric(timepoint), y = ptgi_strength, color = condition)) +
geom_point(alpha = 0.5, size = 1, position = position_jitter(width = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of Depression Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PTGI - Strength", limits = 0:5, labels = 0:5) +
theme_minimal()



# Plot model



plot_model(ptg_strength.mm)

ggplot(rotp_behavioral_long, aes(x = timepoint, y = ptgi_strength, color = condition)) +
  geom_boxplot() +
  theme_bw()


```

PTGI Appreciation - Mixed Model

```{r}

ptg_appreciation.mm <- lmer(ptgi_appreciation ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_appreciation.mm)

sjPlot::tab_model(ptg_appreciation.mm)


# Plot model

plot_model(ptg_appreciation.mm)

ggplot(rotp_behavioral_long, aes(x = timepoint, y = ptgi_appreciation, color = condition)) +
  geom_boxplot() +
  theme_bw()


```

## PTGI Spiritual - Mixed Model

```{r}

ptg_spiritual.mm <- lmer(ptgi_spiritual ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_spiritual.mm)

sjPlot::tab_model(ptg_spiritual.mm)


# Plot model

plot_model(ptg_spiritual.mm)

ggplot(rotp_behavioral_long, aes(x = timepoint, y = ptgi_spiritual, color = condition)) +
  geom_boxplot() +
  theme_bw()


```

# Positive Affect - Mixed Model

```{r}

pos_affect.mm <- lmer(pos_affect ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(pos_affect.mm)

sjPlot::tab_model(pos_affect.mm)

ggplot(merged_deidentified_long_t5_t7_t8, aes(x = timepoint, y = pos_affect, color = condition)) +
geom_point(alpha = 0.3, size = 1, position = position_jitter(width = 0.1, height = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of Positive Affect Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("Positive Affect", limits = 0:6, labels = 0:6) 


# Plot model

plot_model(pos_affect.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = pos_affect, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

# Negative Affect - Mixed Model

```{r}

neg_affect.mm <- lmer(neg_affect ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(neg_affect.mm)

sjPlot::tab_model(neg_affect.mm)


# Plot model

plot_model(neg_affect.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = neg_affect, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

## PHQ Full - Mixed Model

```{r}


phq_full.mm <- lmer(phq_full ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(phq_full.mm)

sjPlot::tab_model(phq_full.mm)


# Plot model

plot_model(phq_full.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = phq_full, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

## PHQ Anxiety - Mixed Model

```{r}


phq_anxiety.mm <- lmer(phq_anxiety ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(phq_anxiety.mm)

sjPlot::tab_model(phq_anxiety.mm)


# Plot model

plot_model(phq_anxiety.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = phq_anxiety, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

## PHQ Depression - Mixed Model

```{r}


phq_depression.mm <- lmer(phq_depression ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(phq_depression.mm)

sjPlot::tab_model(phq_depression.mm)


# Plot model

plot_model(phq_depression.mm)

ggplot(rotp_behavioral_adj_123, aes(x = as.numeric(timepoint), y = phq_depression, color = condition)) +
geom_point(alpha = 0.3, size = 1, position = position_jitter(width = 0.1, height = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of Depression Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PHQ-Depression", limits = 0:6, labels = 0:6) +
theme_minimal()

# Additional Plots

# Create a scatterplot with lines connecting medians
ggplot(rotp_behavioral_adj, aes(x = timepoint, y = phq_depression, group = condition, color = condition)) +
geom_point() +
stat_summary(fun = mean, geom = "line", size = 1.5) +
labs(title = "Depression Across Time") +
scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PHQ-Depression", limits = 0:6, labels = 0:6) +
theme_minimal()

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = phq_depression, color = condition)) +
  geom_boxplot() +
  theme_bw()



```

## Meaning Presence - Mixed Model

```{r}


meaning_presence.mm <- lmer(meaning_presence ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(meaning_presence.mm)

sjPlot::tab_model(meaning_presence.mm)

# Plot model

plot_model(meaning_presence.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = meaning_presence, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

## Meaning Search - Mixed Model

```{r}


meaning_search.mm <- lmer(meaning_search ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(meaning_search.mm)

sjPlot::tab_model(meaning_search.mm)

# Plot model

plot_model(meaning_search.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = meaning_search, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

## Resilience - Mixed Model

```{r}

resilience.mm <- lmer(resilience ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(resilience.mm)

sjPlot::tab_model(resilience.mm)

# Plot model

plot_model(resilience.mm)

ggplot(merged_deidentified_long_t5_t7_t8, aes(x = timepoint, y = resilience, color = condition)) +
  geom_boxplot() +
  theme_bw()

plot_model(resilience.mm)

ggplot(merged_deidentified_long_t5_t7_t8, aes(x = timepoint, y = resilience, color = condition)) +
geom_point(alpha = 0.3, size = 1, position = position_jitter(width = 0.1, height = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of Resilience Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("Reslience", limits = 0:6, labels = 0:6)



```

## Closeness

```{r}

closeness.mm <- (lmer(closeness ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8))

summ(closeness.mm)

sjPlot::tab_model(closeness.mm)

# Plot model

plot_model(closeness.mm)

ggplot(rotp_behavioral_long_t5_t7_t8, aes(x = timepoint, y = closeness, color = condition)) +
  geom_boxplot() +
  theme_bw()

```

## Global Well-Being

```{r}

gwb.mm <- (lmer(global_health_full ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8))

summ(gwb.mm)

sjPlot::tab_model(gwb.mm)

```

## Social Well-Being

```{r}

swb.mm <-(lmer(swb ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8))

summ(swb.mm)

sjPlot::tab_model(swb.mm)

```

## Self-Fulfilling Meta Mindset

```{r}

sfmm.mm <-(lmer(sfmm ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8))

summ(sfmm.mm)

sjPlot::tab_model(sfmm.mm)

```

## Controllable Meta Mindset

```{r}

cmm.mm <-(lmer(cmm ~ condition * as.factor(timepoint) + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8))

summ(cmm.mm)

sjPlot::tab_model(cmm.mm)

```


```{r}

rotp_summaries_long <- rotp_behavioral_long %>% 
  select(c(participant_id, timepoint, condition, branch, ptgi_full:closeness))


write_sav(rotp_summaries_long, "/Users/barreraj/Box Sync/COVID19/COVID Intervention + Physio/Analyses/Deidentified Data/ROTP_Summaries.sav")
```


Merge data long with physio

```{r}

physio_for_merge <- rotp_merged %>% 
  select(participant_id, )

```

# CRP/Depression Mediation

```{r}

library(lavaan)

# Create new dataset


ptgi_sfmm_med_model_df <- merged_deidentified_long_t5_t7_t8 %>% 
  select(participant_id, timepoint, condition, ptgi_full, sfmm)

ptgi_sfmm_med_model <- '
             # mediator
             sfmm ~ a*condition
             ptgi_full ~ b*sfmm
           
             # direct effect
             ptgi_full ~  c*condition

           # indirect effect (a*b)
             ab := a*b

           # total effect
             total := c + (a*b)
             '
         
ptgi_sfmm <- sem(ptgi_sfmm_med_model, data = ptgi_sfmm_med_model_df, meanstructure = TRUE,
           se = "boot", bootstrap = 500)

summary(ptgi_sfmm, fit.measures=T, standardized=T, ci=TRUE)

```

# IL10/Depression Mediation

```{r}

library(lavaan)

# Create new dataset


IL10_dep_med_model_df <- rotp_behavioral_physio_adj %>% 
  filter(timepoint == 3, branch == "physio") %>% 
  select(participant_id, timepoint, condition, phq_depression, IL10_Log2Transformed)

IL10_dep_med_model <- '
             # mediator
             IL10_Log2Transformed ~ a*condition
             phq_depression ~ b*IL10_Log2Transformed
           
             # direct effect
             phq_depression ~  c*condition

           # indirect effect (a*b)
             ab := a*b

           # total effect
             total := c + (a*b)
             '
         
IL10_dep_med <- sem(IL10_dep_med_model, data = IL10_dep_med_model_df, meanstructure = TRUE,
           se = "boot", bootstrap = 500)

summary(IL10_dep_med, fit.measures=T, standardized=T, ci=TRUE)




```

# IL10/Depression Mediation (Change scores)


```{r}

library(lavaan)

# Create new dataset


IL10_dep_med_model_df <- merged_deidentified_long_t5_t7_t8 %>% 
  filter((timepoint == 3 | timepoint == 1), branch == "physio") %>% 
  select(participant_id, timepoint, condition, phq_depression, IL10_Log2Transformed)

IL10_t1 <- IL10_dep_med_model_df %>% 
  filter(timepoint == 1)

IL10_t3 <- IL10_dep_med_model_df %>% 
  filter(timepoint == 3)

IL10_1_3 <- inner_join(IL10_t1, IL10_t3, by = "participant_id", suffix = c("_t1", "_t3")) %>% 
  mutate(depression_change = phq_depression_t3 - phq_depression_t1,
         IL10_change = IL10_Log2Transformed_t3 - IL10_Log2Transformed_t1)




IL10_1_3_model <- '
             # mediator
             IL10_change ~ a*condition_t3
             depression_change ~ b*IL10_change
           
             # direct effect
             depression_change ~  c*condition_t3

           # indirect effect (a*b)
             ab := a*b

           # total effect
             total := c + (a*b)
             '
         
IL10_1_3_model_med <- sem(IL10_1_3_model, data = IL10_1_3, meanstructure = TRUE,
           se = "boot", bootstrap = 500)

summary(IL10_1_3_model_med, fit.measures=T, standardized=T, ci=TRUE)

install.packages("semPlot")

library(semPlot)

semPaths(IL10_1_3_model_med, whatLabels = "std", style = "lisrel", layout = "tree",
         rotation = 2)


```

Experimenting with multiple imputation

```{r}

rotp_imputation <- rotp_summaries_long

imputed <- mice(rotp_imputation, maxit=0)

predictor_matrix <- imputed$predictorMatrix

meth <- imputed$method

imp2 <- mice(rotp_imputation, maxit = 5, 
             predictorMatrix = predictor_matrix, 
             method = meth, print =  FALSE)

fitimp <- with(imp2, lmer(closeness ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))


fitimp <- with(imp2, lmer(co_mindset ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))


fitimp <- with(imp2, lmer(ptgi_full ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))


fitimp <- with(imp2, lmer(pos_affect ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))


fitimp <- with(imp2, lmer(neg_affect ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))


fitimp <- with(imp2, lmer(meaning_presence ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))


fitimp <- with(imp2, lmer(resilience ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))



fitimp <- with(imp2, lmer(closeness ~ condition * timepoint + (1 | participant_id)))

summary(pool(fitimp))





```

# Moderator analyses

```{r}

# race_ethnicity x ptgi

merged_deidentified_long_t5_t7_t8 <- merged_deidentified_long_t5_t7_t8 %>% 
  mutate(race_categorical = ifelse(race_ethnicity == "White", "White",
                                   ifelse(race_ethnicity != "White", "PoC", NA)))

merged_deidentified_long_white_black <- merged_deidentified_long_t5_t7_t8 %>% 
  filter(race_ethnicity == "Black" | race_ethnicity == "White")

ptg_race_full.mm <- lmer(ptgi_full ~ condition * as.factor(timepoint) * race_ethnicity + (1 | participant_id), 
                   data = merged_deidentified_long_white_black)

summ(ptg_race_full.mm)

sjPlot::tab_model(ptg_race_full.mm)

# education x ptgi

ptg_full_education.mm <- lmer(ptgi_full ~ condition * as.factor(timepoint) * education + (1 | participant_id), 
                   data = merged_deidentified_long_t5_t7_t8)

summ(ptg_full_education.mm)

sjPlot::tab_model(ptg_full_education.mm)

# political x depression

political_simplified <- merged_deidentified_long_t5_t7_t8 %>% 
  mutate(political_categorical = ifelse(political_party == "Democrat", "Dem",
                                        "Not Dem")) %>% 
  filter(!(is.na(political_categorical)))

depression_political.mm <- lmer(phq_depression ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(depression_political.mm)

sjPlot::tab_model(depression_political.mm)

# political x co_mindset

com_political.mm <- lmer(co_mindset ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(com_political.mm)

sjPlot::tab_model(com_political.mm)

# political x ptgi_full

ptgi_political.mm <- lmer(ptgi_full ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(ptgi_political.mm)

sjPlot::tab_model(ptgi_political.mm)

plot_model(ptgi_political.mm)

ggplot(political_simplified, aes(x = timepoint, y = ptgi_full, color = condition)) +
geom_point(alpha = 0.3, size = 1, position = position_jitter(width = 0.1, height = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of PTGI Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PTGI-Full", limits = 0:6, labels = 0:6) +
  facet_grid(rows = vars(political_categorical)) +
theme_minimal()


# political x ptgi_relationships

ptgi_relationships_political.mm <- lmer(ptgi_relationships ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(ptgi_relationships_political.mm)

sjPlot::tab_model(ptgi_relationships_political.mm)

ggplot(political_simplified, aes(x = timepoint, y = ptgi_relationships, color = condition)) +
geom_point(alpha = 0.3, size = 1, position = position_jitter(width = 0.1, height = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of PTGI (Relationships) Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PTGI-Relationships", limits = 0:6, labels = 0:6) +
  facet_grid(rows = vars(political_categorical)) +
theme_minimal()

# political x ptgi_possibilities

ptgi_possibilities_political.mm <- lmer(ptgi_possibilities ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(ptgi_possibilities_political.mm)

sjPlot::tab_model(ptgi_possibilities_political.mm)

ggplot(political_simplified, aes(x = timepoint, y = ptgi_possibilities, color = condition)) +
geom_point(alpha = 0.3, size = 1, position = position_jitter(width = 0.1, height = 0.2)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Linear Mixed Effects Model of PTGI (Possibilities) Across Time x Condition") +
  scale_x_discrete("Timepoint", limits = 1:3, labels = 1:3) +
scale_y_discrete("PTGI-Possibilities", limits = 0:6, labels = 0:6) +
  facet_grid(rows = vars(political_categorical)) +
theme_minimal()

# political x ptgi_strength

ptgi_strength_political.mm <- lmer(ptgi_strength ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(ptgi_strength_political.mm)

sjPlot::tab_model(ptgi_strength_political.mm)

# political x ptgi_appreciation

ptgi_appreciation_political.mm <- lmer(ptgi_appreciation ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(ptgi_appreciation_political.mm)

sjPlot::tab_model(ptgi_appreciation_political.mm)

table(political_simplified$political_categorical, political_simplified$condition)

# political x meaning (presence and search)

meaning_presence_political.mm <- lmer(meaning_presence ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(meaning_presence_political.mm)

sjPlot::tab_model(meaning_presence_political.mm)


meaning_search_political.mm <- lmer(meaning_search ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(meaning_search_political.mm)

sjPlot::tab_model(meaning_search_political.mm)


# Resilience

resilience_political.mm <- lmer(resilience ~ condition * as.factor(timepoint) * political_categorical + (1 | participant_id), 
                   data = political_simplified)

summ(resilience_political.mm)

sjPlot::tab_model(resilience_political.mm)

table(mer)


```











